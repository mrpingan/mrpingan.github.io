<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://mrpingan.github.io</id>
    <title>Ping&apos;s Home</title>
    <updated>2019-09-09T10:06:07.824Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="https://mrpingan.github.io"/>
    <link rel="self" href="https://mrpingan.github.io/atom.xml"/>
    <subtitle>温故而知新</subtitle>
    <logo>https://mrpingan.github.io/images/avatar.png</logo>
    <icon>https://mrpingan.github.io/favicon.ico</icon>
    <rights>All rights reserved 2019, Ping&apos;s Home</rights>
    <entry>
        <title type="html"><![CDATA[Jxplorer连接LDAP]]></title>
        <id>https://mrpingan.github.io/post/jxplorer-lian-jie-ldap</id>
        <link href="https://mrpingan.github.io/post/jxplorer-lian-jie-ldap">
        </link>
        <updated>2019-09-08T05:20:46.000Z</updated>
        <content type="html"><![CDATA[<p><code>Jxplorer</code>是JAVA连接LDAP的客户端，支持多种连接SSL、SASL，同时也支持很多平台。官网下载地址：http://jxplorer.org/downloads/users.html。</p>
<h1 id="非安全连接">非安全连接</h1>
<p>如果LDAP服务端未开启TLS，此时建立的连接是非安全连接，使用的端口是389.<br>
<img src="https://mrpingan.github.io/post-images/1567920506007.png" alt=""><br>
填写对应的信息，就可以连接上了</p>
<h1 id="安全连接">安全连接</h1>
<p>LDAP使用的是SSL，即重新开启一个SSL端口来建立安全通道，不过这种方式已经被淘汰。取而代之的是STARTTLS，这种方式和389复用同一个通道，不过传输的数据都是加密的。<br>
我这儿使用的是SSL，而且使用的自签名CA证书。并未使用STARTTLS。</p>
<h2 id="导入ca证书">导入CA证书</h2>
<p>选择&quot;安全&quot; —— &quot;信任的服务器及CA&quot;<br>
<img src="https://mrpingan.github.io/post-images/1567920720636.png" alt=""><br>
选择&quot;新增凭证&quot;<br>
<img src="https://mrpingan.github.io/post-images/1567920784200.png" alt=""><br>
选择指定的CA证书，并为CA证书指定一个名称<br>
<img src="https://mrpingan.github.io/post-images/1567920819137.png" alt=""><br>
还需要输入一个密码，默认的密码是&quot;changeit&quot;<br>
<img src="https://mrpingan.github.io/post-images/1567920864163.png" alt=""><br>
点击&quot;确认&quot;之后就可以正常导入了</p>
<p>新建一个连接<br>
<img src="https://mrpingan.github.io/post-images/1567920948221.png" alt=""><br>
填写对应的信息，ssl的方式需要修改端口为636。如果LDAP使用的是STARTTLS的方式，则端口依然是389。</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Centos 7/RHEL 7配置OpenLDAP SSL]]></title>
        <id>https://mrpingan.github.io/post/centos-7rhel-7-pei-zhi-openldap-ssl</id>
        <link href="https://mrpingan.github.io/post/centos-7rhel-7-pei-zhi-openldap-ssl">
        </link>
        <updated>2019-09-07T09:01:46.000Z</updated>
        <content type="html"><![CDATA[<h1 id="预先准备">预先准备</h1>
<p>在<code>/etc/hosts</code>中添加一条LDAP服务端主机域名映射记录</p>
<pre><code>192.168.33.11 server.itzgeek.local server
</code></pre>
<h1 id="创建-ldap-证书">创建 LDAP 证书</h1>
<h2 id="自签名证书">自签名证书</h2>
<p>为LDAP服务端创建一个自签名证书,下面的命令将会在<code>/etc/openldap/certs/</code>生成证书和私钥</p>
<pre><code>openssl req -new -x509 -nodes -out /etc/openldap/certs/itzgeekldap.crt -keyout /etc/openldap/certs/itzgeekldap.key -days 1460
</code></pre>
<p>输出内容：</p>
<pre><code>Generating a 2048 bit RSA private key
.................................................................................+++
...................................+++
writing new private key to '/etc/openldap/certs/itzgeekldap.key'
-----
You are about to be asked to enter information that will be incorporated
into your certificate request.
What you are about to enter is what is called a Distinguished Name or a DN.
There are quite a few fields but you can leave some blank
For some fields there will be a default value,
If you enter '.', the field will be left blank.
-----
Country Name (2 letter code) [XX]:CN
State or Province Name (full name) []:shenzhen
Locality Name (eg, city) [Default City]:shenzhen
Organization Name (eg, company) [Default Company Ltd]:ITzGeek
Organizational Unit Name (eg, section) []:IT Infra
Common Name (eg, your name or your server's hostname) []:server.itzgeek.local
Email Address []:admin@itzgeek.com
</code></pre>
<p>设置权限</p>
<pre><code>chown -R ldap:ldap /etc/openldap/certs/itzgeek*
</code></pre>
<p>查看创建的证书和私钥</p>
<pre><code>[root@server openldap]# ll /etc/openldap/certs/itz*
-rw-r--r--. 1 root root 1456 Sep  7 09:08 /etc/openldap/certs/itzgeekldap.crt
-rw-r--r--. 1 root root 1704 Sep  7 09:08 /etc/openldap/certs/itzgeekldap.key
</code></pre>
<p>创建<code>certs.ldif</code>配置LDAP使用自签名证书</p>
<pre><code>dn: cn=config
changetype: modify
replace: olcTLSCertificateFile
olcTLSCertificateFile: /etc/openldap/certs/itzgeekldap.crt
-
replace: olcTLSCertificateKeyFile
olcTLSCertificateKeyFile: /etc/openldap/certs/itzgeekldap.key
</code></pre>
<p>刷新配置：</p>
<pre><code>ldapmodify -Y EXTERNAL  -H ldapi:/// -f certs.ldif
</code></pre>
<p>验证配置：</p>
<pre><code>slaptest -u
</code></pre>
<p>配置正确显示如下：</p>
<pre><code>config file testing succeeded
</code></pre>
<h1 id="自定义ca签名证书">自定义CA签名证书</h1>
<p>创建根私钥</p>
<pre><code>cd  /etc/openldap/certs/
openssl genrsa -out itzgeekrootCA.key 2048
</code></pre>
<p>创建自签名根证书</p>
<pre><code>openssl req -x509 -new -nodes -key itzgeekrootCA.key -sha256 -days 1024 -out itzgeekrootCA.pem
</code></pre>
<p>输入信息如下：</p>
<pre><code>You are about to be asked to enter information that will be incorporated
into your certificate request.
What you are about to enter is what is called a Distinguished Name or a DN.
There are quite a few fields but you can leave some blank
For some fields there will be a default value,
If you enter '.', the field will be left blank.
-----
Country Name (2 letter code) [XX]:CN
State or Province Name (full name) []:shenzhen
Locality Name (eg, city) [Default City]:shenzhen
Organization Name (eg, company) [Default Company Ltd]:ITzGeek
Organizational Unit Name (eg, section) []:IT Infra
Common Name (eg, your name or your server's hostname) []:ITzGeek Root CA
Email Address []:admin@itzgeek.com
</code></pre>
<p>LDAP服务端创建私钥</p>
<pre><code>openssl genrsa -out itzgeekldap.key 2048
</code></pre>
<p>有了私钥之后，就可以创建一个csr(certificate signing request)文件</p>
<pre><code>openssl req -new -key itzgeekldap.key -out itzgeekldap.csr
</code></pre>
<p>输出结果如下：</p>
<pre><code>You are about to be asked to enter information that will be incorporated
into your certificate request.
What you are about to enter is what is called a Distinguished Name or a DN.
There are quite a few fields but you can leave some blank
For some fields there will be a default value,
If you enter '.', the field will be left blank.
-----
Country Name (2 letter code) [XX]:CN
State or Province Name (full name) []:shenzhen
Locality Name (eg, city) [Default City]:shenzhen
Organization Name (eg, company) [Default Company Ltd]:ITzGeek
Organizational Unit Name (eg, section) []:IT Infra
Common Name (eg, your name or your server's hostname) []:server.itzgeek.local
Email Address []:admin@itzgeek.com

Please enter the following 'extra' attributes
to be sent with your certificate request
A challenge password []:
An optional company name []:
</code></pre>
<p>使用用户根CA签名一个CSR</p>
<pre><code>openssl x509 -req -in itzgeekldap.csr -CA itzgeekrootCA.pem -CAkey itzgeekrootCA.key -CAcreateserial -out itzgeekldap.crt -days 1460 -sha256
</code></pre>
<p>设置权限</p>
<pre><code>chown -R ldap:ldap /etc/openldap/certs/itzgeek*
</code></pre>
<p>查看证书文件</p>
<pre><code>-rw-r--r--. 1 ldap ldap 1334 Sep  7 11:23 /etc/openldap/certs/itzgeekldap.crt
-rw-r--r--. 1 ldap ldap 1074 Sep  7 11:22 /etc/openldap/certs/itzgeekldap.csr
-rw-r--r--. 1 ldap ldap 1675 Sep  7 11:20 /etc/openldap/certs/itzgeekldap.key
-rw-r--r--. 1 ldap ldap 1679 Sep  7 11:17 /etc/openldap/certs/itzgeekrootCA.key
-rw-r--r--. 1 ldap ldap 1444 Sep  7 11:18 /etc/openldap/certs/itzgeekrootCA.pem
-rw-r--r--. 1 ldap ldap   17 Sep  7 11:23 /etc/openldap/certs/itzgeekrootCA.srl
</code></pre>
<p>创建certs.ldif文件来配置LDAP</p>
<pre><code>vi certs.ldif
</code></pre>
<p>文件内容如下：</p>
<pre><code>dn: cn=config
changetype: modify
replace: olcTLSCACertificateFile
olcTLSCACertificateFile: /etc/openldap/certs/itzgeekrootCA.pem
-
replace: olcTLSCertificateFile
olcTLSCertificateFile: /etc/openldap/certs/itzgeekldap.crt
-
replace: olcTLSCertificateKeyFile
olcTLSCertificateKeyFile: /etc/openldap/certs/itzgeekldap.key
</code></pre>
<p>应用配置文件</p>
<pre><code>ldapmodify -Y EXTERNAL  -H ldapi:/// -f certs.ldif
</code></pre>
<p>输出如下：</p>
<pre><code>SASL/EXTERNAL authentication started
SASL username: gidNumber=0+uidNumber=0,cn=peercred,cn=external,cn=auth
SASL SSF: 0
modifying entry &quot;cn=config&quot;

</code></pre>
<h1 id="配置openldap-ssl">配置OpenLDAP SSL</h1>
<p>编辑<code>/etc/sysconfig/slapd</code>,增加<code>ldaps:///</code></p>
<pre><code>SLAPD_URLS=&quot;ldapi:/// ldap:/// ldaps:///&quot;
</code></pre>
<p>重启服务</p>
<pre><code>systemctl restart slapd
</code></pre>
<p>查看启动端口</p>
<pre><code>tcp    LISTEN     0      128       *:636                   *:*                   users:((&quot;slapd&quot;,pid=28160,fd=10))
tcp    LISTEN     0      128      :::636                  :::*                   users:((&quot;slapd&quot;,pid=28160,fd=11))
</code></pre>
<p>636是OpenLDAP ssl端口。</p>
<h1 id="openldap客户端配置ssl">OpenLDAP客户端配置SSL</h1>
<p>安装软件包</p>
<pre><code>yum install -y openldap-clients nss-pam-ldapd
</code></pre>
<p>执行<code>authconfig</code>命令将客户端机器注册到服务端</p>
<pre><code>authconfig --enableldap --enableldapauth --ldapserver=ldaps://server.itzgeek.local --ldapbasedn=&quot;dc=itzgeek,dc=local&quot; --enablemkhomedir --disableldaptls --update
</code></pre>
<h2 id="客户端配置">客户端配置</h2>
<p>编辑<code>nslcd.conf</code>配置文件</p>
<pre><code>	vi /etc/nslcd.conf
</code></pre>
<p>增加一行</p>
<pre><code>tls_reqcert allow
</code></pre>
<p>拷贝LDAP服务端的CA公钥到客户端的<code>/etc/openldap/cacerts</code>目录中</p>
<pre><code>cd /etc/openldap/cacerts/
scp -pr 192.168.33.11:/etc/openldap/certs/itzgeekrootCA.pem /etc/openldap/cacerts
</code></pre>
<p>为CA证书创建hash值</p>
<pre><code>/etc/pki/tls/misc/c_hash /etc/openldap/cacerts/itzgeekrootCA.pem
</code></pre>
<p>输出：</p>
<pre><code>1a981562.0 =&gt; /etc/openldap/cacerts/itzgeekrootCA.pem
</code></pre>
<p>创建一个软连接</p>
<pre><code>ln -s /etc/openldap/cacerts/itzgeekrootCA.pem 1a981562.0
</code></pre>
<p>重启LDAP客户端服务</p>
<pre><code>systemctl restart nslcd
</code></pre>
<h1 id="验证ldap登录">验证LDAP登录</h1>
<p>使用<code>getent</code>命令来获取LDAP服务端的条目</p>
<pre><code>getent passwd raj
</code></pre>
<p>输出：</p>
<pre><code>raj:x:9999:100:Raj [Admin (at) ITzGeek]:/home/raj:/bin/bash
</code></pre>
<p>登录：<br>
<img src="https://mrpingan.github.io/post-images/1567857602492.png" alt=""><br>
查看日志TLS建立成功<br>
<img src="https://mrpingan.github.io/post-images/1567858011786.png" alt=""></p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Centos7/RHEL 7 LDAP 配置]]></title>
        <id>https://mrpingan.github.io/post/ldap-ssl-pei-zhi</id>
        <link href="https://mrpingan.github.io/post/ldap-ssl-pei-zhi">
        </link>
        <updated>2019-09-07T06:48:27.000Z</updated>
        <content type="html"><![CDATA[<h1 id="环境">环境</h1>
<table>
<thead>
<tr>
<th>hostname</th>
<th>ip</th>
<th>os</th>
<th>purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td>server.itzgeek.local</td>
<td>192.168.33.11</td>
<td>centos 7</td>
<td>服务端</td>
</tr>
<tr>
<td>client.itzgeek.local</td>
<td>192.168.33.12</td>
<td>centos 7</td>
<td>客户端</td>
</tr>
</tbody>
</table>
<h1 id="要求">要求</h1>
<p>确认LDAP服务端server.itzgeek.local(192.168.33.11)和LDAP客户端client.itzgeek.local(192.168.33.12)都可以ping通<br>
保证每一台服务器的hosts文件中都包含</p>
<pre><code>192.168.33.12   client.itzgeek.local    client
192.168.33.11   server.itzgeek.local    server
</code></pre>
<h1 id="安装ldap包">安装LDAP包</h1>
<p>安装LDAP包，openldap-servers是服务端的包，openldap-clients是客户端<br>
<code>yum -y install openldap compat-openldap openldap-clients openldap-servers openldap-servers-sql openldap-devel</code></p>
<h2 id="启动ldap-server并加入自启动">启动LDAP server并加入自启动</h2>
<pre><code>systemctl start slapd
systemctl enable slapd
</code></pre>
<p>查看LDAP是否启动</p>
<pre><code>ss -antup | grep -i 389
</code></pre>
<p>输出如下表示端口已启动</p>
<pre><code>tcp    LISTEN     0      128       *:389                   *:*                   users:((&quot;slapd&quot;,pid=5740,fd=8))
tcp    LISTEN     0      128      :::389                  :::*                   users:((&quot;slapd&quot;,pid=5740,fd=9))
</code></pre>
<h2 id="设置管理员密码">设置管理员密码</h2>
<p>生成ssha加密密码,比如这儿的密码为admin</p>
<pre><code>slappasswd -h {SSHA} -s admin
</code></pre>
<p>输出：</p>
<pre><code>{SSHA}nU4sM/uweUR3xhk1A521Fs5DlAO/gEbx
</code></pre>
<h2 id="配置ldap服务端">配置LDAP服务端</h2>
<p>OpenLDAP服务端配置文件放在<code>/etc/openldap/slapd.d/</code>。修改一下<code>olcSuffix</code>和<code>olcRootDN</code>变量。<br>
<code>olcSuffix</code>    ——   数据库后缀，它是LDAP服务器提供信息的域名。简单来说，它应该更改为域名。<br>
<code>olcRootDN</code> ——   一般指的是root用户，具有所有访问权限的用户<br>
<code>olcRootPW</code> ——  RootDN的密码</p>
<blockquote>
<p>以上的变量需要在<code>/etc/openldap/slapd.d/cn=config/olcDatabase={2}hdb.ldif</code>中更新，不建议手动修改这个文件，所有的变更都应该创建一个<code>.ldif</code>文件，使用ldap的命令去执行</p>
</blockquote>
<pre><code>vi db.ldif
</code></pre>
<p>添加下面的内容：</p>
<pre><code>dn: olcDatabase={2}hdb,cn=config
changetype: modify
replace: olcSuffix
olcSuffix: dc=itzgeek,dc=local

dn: olcDatabase={2}hdb,cn=config
changetype: modify
replace: olcRootDN
olcRootDN: cn=admin,dc=itzgeek,dc=local

dn: olcDatabase={2}hdb,cn=config
changetype: modify
replace: olcRootPW
olcRootPW: {SSHA}nU4sM/uweUR3xhk1A521Fs5DlAO/gEbx
</code></pre>
<p>把配置发送给服务端，不需重启即时生效</p>
<pre><code>ldapmodify -Y EXTERNAL  -H ldapi:/// -f db.ldif
</code></pre>
<p>输出下面内容表示成功：</p>
<pre><code>SASL/EXTERNAL authentication started
SASL username: gidNumber=0+uidNumber=0,cn=peercred,cn=external,cn=auth
SASL SSF: 0
modifying entry &quot;olcDatabase={2}hdb,cn=config&quot;

modifying entry &quot;olcDatabase={2}hdb,cn=config&quot;

modifying entry &quot;olcDatabase={2}hdb,cn=config&quot;
</code></pre>
<p>刚才的文件中我们设置了basedn,rootdn,rootpassword，现在我们设置一下ACL权限</p>
<pre><code>vi monitor.ldif
</code></pre>
<p>使用下面的配置：</p>
<pre><code>dn: olcDatabase={1}monitor,cn=config
changetype: modify
replace: olcAccess
olcAccess: {0}to * by dn.base=&quot;gidNumber=0+uidNumber=0,cn=peercred,cn=external, cn=auth&quot; read by dn.base=&quot;cn=admin,dc=itzgeek,dc=local&quot; read by * none
</code></pre>
<p>同样的，也要发送配置给服务端</p>
<pre><code>ldapmodify -Y EXTERNAL  -H ldapi:/// -f monitor.ldif
</code></pre>
<p>输出如下，表示成功：</p>
<pre><code>SASL/EXTERNAL authentication started
SASL username: gidNumber=0+uidNumber=0,cn=peercred,cn=external,cn=auth
SASL SSF: 0
modifying entry &quot;olcDatabase={1}monitor,cn=config&quot;
</code></pre>
<h1 id="设置ldap数据库">设置LDAP数据库</h1>
<p>拷贝数据库样本配置文件到<code>/var/lib/ldap</code>,更新文件权限</p>
<pre><code>cp /usr/share/openldap-servers/DB_CONFIG.example /var/lib/ldap/DB_CONFIG
chown ldap:ldap /var/lib/ldap/*
</code></pre>
<p>增加inetorgperson LDAP schemas，但是inetorgperson依赖cosine和nis LDAP schemas，所以要先安装cosine和nis LDAP schemas</p>
<pre><code>ldapadd -Y EXTERNAL -H ldapi:/// -f /etc/openldap/schema/cosine.ldif
ldapadd -Y EXTERNAL -H ldapi:/// -f /etc/openldap/schema/nis.ldif 
ldapadd -Y EXTERNAL -H ldapi:/// -f /etc/openldap/schema/inetorgperson.ldif
</code></pre>
<p>配置基本结构配置文件base.ldif</p>
<pre><code>dn: dc=itzgeek,dc=local
dc: itzgeek
objectClass: top
objectClass: domain

dn: cn=admin ,dc=itzgeek,dc=local
objectClass: organizationalRole
cn: admin
description: LDAP Manager

dn: ou=People,dc=itzgeek,dc=local
objectClass: organizationalUnit
ou: People

dn: ou=Group,dc=itzgeek,dc=local
objectClass: organizationalUnit
ou: Group
</code></pre>
<p>生成目录结构：</p>
<pre><code>ldapadd -x -W -D &quot;cn=admin,dc=itzgeek,dc=local&quot; -f base.ldif
</code></pre>
<p>要输入<code>cn=admin,dc=itzgeek,dc=local</code>的密码才可以</p>
<p>输出内容：</p>
<pre><code>Enter LDAP Password:
adding new entry &quot;dc=itzgeek,dc=local&quot;

adding new entry &quot;cn=admin ,dc=itzgeek,dc=local&quot;

adding new entry &quot;ou=People,dc=itzgeek,dc=local&quot;

adding new entry &quot;ou=Group,dc=itzgeek,dc=local&quot;
</code></pre>
<p>使用<code>JXplorer</code>查看目录树<br>
<img src="https://mrpingan.github.io/post-images/1567842998859.png" alt=""></p>
<h1 id="创建ldap用户">创建LDAP用户</h1>
<pre><code>vi raj.ldif
</code></pre>
<p>写入以下内容：</p>
<pre><code>dn: uid=raj,ou=People,dc=itzgeek,dc=local
objectClass: top
objectClass: account
objectClass: posixAccount
objectClass: shadowAccount
cn: raj
uid: raj
uidNumber: 9999
gidNumber: 100
homeDirectory: /home/raj
loginShell: /bin/bash
gecos: Raj [Admin (at) ITzGeek]
userPassword: {crypt}x
shadowLastChange: 17058
shadowMin: 0
shadowMax: 99999
shadowWarning: 7
</code></pre>
<p>把配置写入LDAP服务端</p>
<pre><code>ldapadd -x -W -D &quot;cn=admin,dc=itzgeek,dc=local&quot; -f raj.ldif
</code></pre>
<p>输出如下：</p>
<pre><code>Enter LDAP Password:
adding new entry &quot;uid=raj,ou=People,dc=itzgeek,dc=local&quot;
</code></pre>
<p>给<code>raj</code>用户设置一个密码</p>
<pre><code>ldappasswd -s password123 -W -D &quot;cn=admin,dc=itzgeek,dc=local&quot; -x &quot;uid=raj,ou=People,dc=itzgeek,dc=local&quot;
</code></pre>
<p>-s 给指定用户指定密码<br>
-x 指定配置密码用户<br>
-D 指定可以修改密码的dn<br>
验证<code>raj</code>用户：</p>
<pre><code>ldapsearch -x cn=raj -b dc=itzgeek,dc=local
</code></pre>
<p>输出如下：</p>
<pre><code># extended LDIF
#
# LDAPv3
# base &lt;dc=itzgeek,dc=local&gt; with scope subtree
# filter: cn=raj
# requesting: ALL
#

# raj, People, itzgeek.local
dn: uid=raj,ou=People,dc=itzgeek,dc=local
objectClass: top
objectClass: account
objectClass: posixAccount
objectClass: shadowAccount
cn: raj
uid: raj
uidNumber: 9999
gidNumber: 100
homeDirectory: /home/raj
loginShell: /bin/bash
gecos: Raj [Admin (at) ITzGeek]
shadowLastChange: 17058
shadowMin: 0
shadowMax: 99999
shadowWarning: 7
userPassword:: e1NTSEF9SmwvcUZRSzAzRVV0dmZ0UXNPYU9zZjdvdWdDRGR2dlA=

# search result
search: 2
result: 0 Success

# numResponses: 2
# numEntries: 1
</code></pre>
<p>删除一个条目：</p>
<pre><code>ldapdelete -W -D &quot;cn=admin,dc=itzgeek,dc=local&quot; &quot;uid=raj,ou=People,dc=itzgeek,dc=local&quot;
</code></pre>
<h1 id="防火墙">防火墙</h1>
<p>如果开启了防火墙，要在防火墙上开启端口TCP(389)</p>
<pre><code>firewall-cmd --permanent --add-service=ldap
firewall-cmd --reload
</code></pre>
<h1 id="开启ldap日志">开启LDAP日志</h1>
<p>pass</p>
<h1 id="ldap客户端配置">LDAP客户端配置</h1>
<p>在客户端机器上安装必要的包</p>
<pre><code>yum install -y openldap-clients nss-pam-ldapd
</code></pre>
<p>执行下面的命令将客户端注册到LDAP服务端上,192.168.33.11是LDAP服务端的IP地址</p>
<pre><code>authconfig --enableldap --enableldapauth --ldapserver=192.168.33.11 --ldapbasedn=&quot;dc=itzgeek,dc=local&quot; --enablemkhomedir --update
</code></pre>
<p>重启LDAP客户端服务</p>
<pre><code>systemctl restart  nslcd
</code></pre>
<h1 id="验证ldap登录">验证LDAP登录</h1>
<p>使用<code>getent</code>命令来从LDAP服务端获取条目</p>
<pre><code>getent passwd raj
</code></pre>
<p>输出：</p>
<pre><code>raj:x:9999:100:Raj [Admin (at) ITzGeek]:/home/raj:/bin/bash
</code></pre>
<p>为了验证，在客户端机器上使用LDAP用户<code>raj</code>登录</p>
<pre><code>ssh raj@192.168.33.12
</code></pre>
<p><img src="https://mrpingan.github.io/post-images/1567846300534.png" alt=""><br>
登录成功之后，就会创建一个家目录，由于我是第二次登录，所以看不到创建家目录的提示信息。</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[confluence禁用忘记密码功能]]></title>
        <id>https://mrpingan.github.io/post/confluence-jin-yong-wang-ji-mi-ma-gong-neng</id>
        <link href="https://mrpingan.github.io/post/confluence-jin-yong-wang-ji-mi-ma-gong-neng">
        </link>
        <updated>2019-09-04T04:36:56.000Z</updated>
        <content type="html"><![CDATA[<p>禁用忘记密码功能很简单，只需要增加一个css就可以。<br>
使用管理员登录<br>
<img src="https://mrpingan.github.io/post-images/1567572057774.png" alt=""><br>
增加样式</p>
<pre><code>#forgot-password {
    display:none;
}
</code></pre>
<p>然后，在登录界面就看不到&quot;忘记密码&quot;的选项了 。其实只是在前端页面上隐藏了。</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[maven打包栈溢出的问题]]></title>
        <id>https://mrpingan.github.io/post/maven-da-bao-zhan-yi-chu-de-wen-ti</id>
        <link href="https://mrpingan.github.io/post/maven-da-bao-zhan-yi-chu-de-wen-ti">
        </link>
        <updated>2019-08-29T15:01:36.000Z</updated>
        <content type="html"><![CDATA[<p>今天使用<code>mvn</code>打包Java项目的时候，出现了栈溢出，部分错误日志如下：</p>
<pre><code>Exception in thread &quot;main&quot; java.lang.StackOverflowError
	at java.util.regex.Pattern$Branch.match(Pattern.java:4502)
	at java.util.regex.Pattern$GroupHead.match(Pattern.java:4556)
	at java.util.regex.Pattern$Loop.match(Pattern.java:4683)
	at java.util.regex.Pattern$GroupTail.match(Pattern.java:4615)
	at java.util.regex.Pattern$BranchConn.match(Pattern.java:4466)
	at java.util.regex.Pattern$CharProperty.match(Pattern.java:3694)
	at java.util.regex.Pattern$Branch.match(Pattern.java:4502)
	at java.util.regex.Pattern$GroupHead.match(Pattern.java:4556)
</code></pre>
<p>解决方法：<br>
调整<code>maven</code>的栈大小<br>
通过<code>which mvn</code>找到<code>mvn</code>命令</p>
<pre><code>root@saas3.0_jumper:~# which mvn
/usr/local/maven/bin/mvn
</code></pre>
<p>编辑<code>/usr/local/maven/bin/mvn</code>,在文件开头添加<code>MAVEN_OPTS</code>环境变量，</p>
<pre><code># -----------------------------------------------------------------------------
# Apache Maven Startup Script
#
# Environment Variable Prerequisites
#
#   JAVA_HOME       Must point at your Java Development Kit installation.
#   MAVEN_OPTS      (Optional) Java runtime options used when Maven is executed.
#   MAVEN_SKIP_RC   (Optional) Flag to disable loading of mavenrc files.
# -----------------------------------------------------------------------------
MAVEN_OPTS=&quot;-Xss10240k&quot;
</code></pre>
<p>再次打包，成功。如果这个值还是提示栈溢出的话，可以考虑继续调整Xss的大小，或者在代码层面找原因。</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[jenkins 连接ldap]]></title>
        <id>https://mrpingan.github.io/post/jenkins-lian-jie-ldap</id>
        <link href="https://mrpingan.github.io/post/jenkins-lian-jie-ldap">
        </link>
        <updated>2019-08-21T06:23:35.000Z</updated>
        <content type="html"><![CDATA[<p>jenkins默认安装了ldap插件，通过ldap可以对用户进行授权。相比本地账户而言，更加方便，更加好管理。当用户离职后，直接在ldap中将这个用户删掉就可以了。<br>
想要达到的目的：</p>
<ul>
<li>可以通过ldap用户认证</li>
<li>只有指定的组可以登录Jenkins，不同的组拥有的权限不同</li>
</ul>
<h3 id="ldap设置">ldap设置</h3>
<p>ldap中设置了两个组jenkins-admin、jenkins-user，分别用来在Jenkins中配置不同的权限的。<br>
<img src="https://mrpingan.github.io/post-images/1566377435268.png" alt=""><br>
所有的用户都存在于ou=People叶子中的节点，所有的组都存在于ou=Groups中的节点，比如这儿我就加了一个jenkins节点同样是ou对象，因为我还要在下面增加groupOfNames的组对象，这样的好处是groupOfNames可以增加成员<br>
<img src="https://mrpingan.github.io/post-images/1566377641597.png" alt=""><br>
比如，这儿我就增加了ou=People中的叶子节点</p>
<h3 id="jenkins设置">jenkins设置</h3>
<p>如果通过管理员账号登录jenkins，可以看到这个选项</p>
<p>接下来，选择<code>LDAP</code><br>
<img src="https://mrpingan.github.io/post-images/1566377699539.png" alt=""></p>
<p>填入配置，我的配置如下：<br>
<img src="https://mrpingan.github.io/post-images/1566377716964.png" alt=""><br>
填写完成后，可以验证一下<br>
<img src="https://mrpingan.github.io/post-images/1566377732941.png" alt=""></p>
<p><img src="https://mrpingan.github.io/post-images/1566377752076.png" alt=""><br>
注意这儿的用户名只需要填写<code>User search filter</code>填写cn的值即可，因为我的dn为：cn=pingqiangqiang,ou=People,dc=ping,dc=cn<br>
所以这儿需要填写 cn={0},如果你的dn为uid=pingqiangqiang,ou=People,dc=ping,dc=cn，则<code>User search filter</code>需要填写uid={0},然后通过pingqiangqiang去验证。如果需要通过邮箱验证，则<code>User search filter</code>需要填写mail={0}。</p>
<p><img src="https://mrpingan.github.io/post-images/1566377766023.png" alt=""><br>
如果测试通过，则会显示Authentication: successful之类的信息。</p>
<h4 id="jenkins配置权限">Jenkins配置权限</h4>
<p>还记得我们之前创建的两个组么，jenkins-admin、jenkins-user<br>
在我的ldap中，cn=pingqiangqiang 这个用户属于 jenkins-admin组，cn=test 用户属于 jenkins-user 组<br>
把页面下拉，可以看到 授权策略 现象，点击 安全矩阵 ，然后就可以添加对应的组来对不同的组来授权，组内的成员也会继承组的权限。<br>
<img src="https://mrpingan.github.io/post-images/1566377786644.png" alt=""></p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Django 中的 context_processors 好处]]></title>
        <id>https://mrpingan.github.io/post/django-zhong-de-context_processors-hao-chu</id>
        <link href="https://mrpingan.github.io/post/django-zhong-de-context_processors-hao-chu">
        </link>
        <updated>2019-06-23T13:48:11.000Z</updated>
        <content type="html"><![CDATA[<h1 id="context_processors"><code>context_processors</code></h1>
<p>从字面上理解为上下文，会将请求对象作为参数并以字典的方式合并到context中返回。比如，使用<code>render</code>函数的时候，就需要返回context，有了<code>context_processors</code>,就可以不用再去给模板传递过多的参数。在默认生成的配置文件<code>settings.py</code>中，默认模板引擎包含以下上下文处理器：</p>
<pre><code class="language-python">['django.template.context_processors.debug',
  'django.template.context_processors.request',
  'django.contrib.auth.context_processors.auth',
  'django.contrib.messages.context_processors.messages',]
</code></pre>
<p>除此之外，请求上下文默认开启<code>django.template.context_processors.csrf</code>，这是为了安全考虑，而且已经硬编码了，不能在<code>context_processors</code>中关闭。这就是为什么我们可以在模板中直接使用<code>csrf_token</code>的原因</p>
<p>每一个处理器有顺序。这意味着，如果一个处理器添加了一个变量到上下文，第二个处理器也添加了一个同名的变量到上下文，这样，第二个添加的变量的值会覆盖第一个。</p>
<h2 id="内建的模板上下文处理器">内建的模板上下文处理器</h2>
<h3 id="djangocontribauthcontext_processorsauth">django.contrib.auth.context_processors.auth</h3>
<p>如果这个处理器开启了，每一个请求上下文都将下面的变量：</p>
<ul>
<li><strong>user</strong></li>
</ul>
<p>当前登陆的user对象，或者一个匿名user对象。可以在模板中通过 <strong>user.username</strong>调用</p>
<ul>
<li><code>perms</code></li>
</ul>
<p>当前登陆用户的所有实例。可以在模板中通过<code>perms.models_name.permission_name</code>调用</p>
<h3 id="djangotemplatecontext_processorsdebug">django.template.context_processors.debug</h3>
<p>如果这个选项开启了，每一个请求上下文都将包含下面两个变量。但是只有你的<code>DEBUG</code>设置为<code>True</code>,而且请求的IP地址（<code>request.META['REMOTE_ADDR']</code>）在<code>INTERNAL_IPS</code>设置的列表中：</p>
<ul>
<li>debug</li>
</ul>
<p>可以使用这个变量来测试是否你正处于<code>DEBUG</code>模式</p>
<ul>
<li>sql_queries</li>
</ul>
<p>一个<code>{'sql': ..., 'time': ...}</code>的字典，展示了当前请求的每一个SQL以及执行时间，Django有一个swagger插件可以。</p>
<h3 id="djangotemplatecontext_processorsi18n">django.template.context_processors.i18n</h3>
<p>这个是国际化的一个组件。开启后，在模板中将可以使用一下变量</p>
<ul>
<li>LANGUAGES</li>
</ul>
<p>当前的<code>LANGUAGES</code>设置</p>
<ul>
<li>LANGUAGE_BIDI</li>
<li>LANGUAGE_CODE</li>
</ul>
<h3 id="djangotemplatecontext_processorsmedia">django.template.context_processors.media</h3>
<p>开启后，每一个请求上下文将包含一个<code>MEDIA_URL</code>变量，可以在模板中提供<code>MEDIA_URL</code>的值</p>
<ul>
<li>MEDIA_URL</li>
</ul>
<h3 id="djangotemplatecontext_processorsstatic">django.template.context_processors.static</h3>
<p>开启后，可以在模板中使用 <code>STATIC_URL</code>变量，可以在模板中提供<code>STATIC_URL</code>的在<code>setttings.py</code>中的值，</p>
<ul>
<li>STATIC_URL</li>
</ul>
<h3 id="djangotemplatecontext_processorscsrf">django.template.context_processors.csrf</h3>
<p>这个处理器提供了<strong>csrf_token</strong>模板tag需要的token，用户避免跨站请求攻击</p>
<h3 id="djangotemplatecontext_processorsrequest">django.template.context_processors.request</h3>
<p>这个处理器开启后，每一个处理器上下文都将包含一个<code>request</code>变量，就是当前的<code>HttpRequest</code></p>
<ul>
<li>request</li>
</ul>
<h3 id="djangotemplatecontext_processorstz">django.template.context_processors.tz</h3>
<p>这个处理器开启后，每一个请求上下文都将包含一个<code>TIME_ZONE</code>变量，提供当前的时区</p>
<h3 id="djangocontribmessagescontext_processorsmessages">django.contrib.messages.context_processors.messages</h3>
<p>这个处理器开启后，每一个请求上下文都将包含下面两个变量</p>
<ul>
<li>messages</li>
</ul>
<p>通过django的消息框架设置的messages的列表</p>
<ul>
<li>DEFAULT_MESSAGE_LEVELS</li>
</ul>
<p>一组消息级别名称到其数值的映射</p>
<table>
<thead>
<tr>
<th>Level Constant</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>DEBUG</td>
<td>10</td>
</tr>
<tr>
<td>INFO</td>
<td>20</td>
</tr>
<tr>
<td>SUCCESS</td>
<td>25</td>
</tr>
<tr>
<td>WARNING</td>
<td>30</td>
</tr>
<tr>
<td>ERROR</td>
<td>40</td>
</tr>
</tbody>
</table>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Hello Gridea]]></title>
        <id>https://mrpingan.github.io/post/hello-gridea</id>
        <link href="https://mrpingan.github.io/post/hello-gridea">
        </link>
        <updated>2018-12-11T16:00:00.000Z</updated>
        <summary type="html"><![CDATA[<p>👏  欢迎使用 <strong>Gridea</strong> ！<br>
✍️  <strong>Gridea</strong> 一个静态博客写作客户端。你可以用它来记录你的生活、心情、知识、笔记、创意... ...</p>
]]></summary>
        <content type="html"><![CDATA[<p>👏  欢迎使用 <strong>Gridea</strong> ！<br>
✍️  <strong>Gridea</strong> 一个静态博客写作客户端。你可以用它来记录你的生活、心情、知识、笔记、创意... ...</p>
<!-- more -->
<p><a href="https://github.com/getgridea/gridea">Github</a><br>
<a href="http://hvenotes.fehey.com/">Gridea 主页</a><br>
<a href="http://fehey.com/">示例网站</a></p>
<h2 id="特性">特性👇</h2>
<p>📝  你可以使用最酷的 <strong>Markdown</strong> 语法，进行快速创作</p>
<p>🌉  你可以给文章配上精美的封面图和在文章任意位置插入图片</p>
<p>🏷️  你可以对文章进行标签分组</p>
<p>📋  你可以自定义菜单，甚至可以创建外部链接菜单</p>
<p>💻  你可以在 <strong>𝖶𝗂𝗇𝖽𝗈𝗐𝗌</strong> 或 <strong>𝖬𝖺𝖼𝖮𝖲</strong> 设备上使用此客户端</p>
<p>🌎  你可以使用 <strong>𝖦𝗂𝗍𝗁𝗎𝖻 𝖯𝖺𝗀𝖾𝗌</strong> 或 <strong>Coding Pages</strong> 向世界展示，未来将支持更多平台</p>
<p>💬  你可以进行简单的配置，接入 <a href="https://github.com/gitalk/gitalk">Gitalk</a> 或 <a href="https://github.com/SukkaW/DisqusJS">DisqusJS</a> 评论系统</p>
<p>🇬🇧  你可以使用<strong>中文简体</strong>或<strong>英语</strong></p>
<p>🌁  你可以任意使用应用内默认主题或任意第三方主题，强大的主题自定义能力</p>
<p>🖥  你可以自定义源文件夹，利用 OneDrive、百度网盘、iCloud、Dropbox 等进行多设备同步</p>
<p>🌱 当然 <strong>Gridea</strong> 还很年轻，有很多不足，但请相信，它会不停向前🏃</p>
<p>未来，它一定会成为你离不开的伙伴</p>
<p>尽情发挥你的才华吧！</p>
<p>😘 Enjoy~</p>
]]></content>
    </entry>
</feed>