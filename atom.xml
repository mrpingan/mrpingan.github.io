<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://mrpingan.github.io</id>
    <title>Ping&apos;s Home</title>
    <updated>2019-11-08T05:12:21.825Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="https://mrpingan.github.io"/>
    <link rel="self" href="https://mrpingan.github.io/atom.xml"/>
    <subtitle>æ¸©æ•…è€ŒçŸ¥æ–°</subtitle>
    <logo>https://mrpingan.github.io/images/avatar.png</logo>
    <icon>https://mrpingan.github.io/favicon.ico</icon>
    <rights>All rights reserved 2019, Ping&apos;s Home</rights>
    <entry>
        <title type="html"><![CDATA[openldap é…ç½®mirrormode]]></title>
        <id>https://mrpingan.github.io/post/openldap-pei-zhi-mirrormode</id>
        <link href="https://mrpingan.github.io/post/openldap-pei-zhi-mirrormode">
        </link>
        <updated>2019-11-08T03:28:40.000Z</updated>
        <content type="html"><![CDATA[<h1 id="ç®€ä»‹">ç®€ä»‹</h1>
<p>MirrorMode æ¨¡å¼é•œåƒåŒæ­¥æ¨¡å¼ï¼Œè€Œä¸”ä¸»æœåŠ¡å™¨äº’ç›¸ä»¥æ¨çš„æ–¹å¼å®ç°ç›®å½•æ ‘æ¡ç›®åŒæ­¥ï¼Œæœ€å¤šå…è®¸ä¸”ä¸¤å°æœºå™¨ä¸ºä¸»æœåŠ¡å™¨ã€‚å¦‚æœè¦æ·»åŠ æ›´å¤šèŠ‚ç‚¹ï¼Œæ­¤æ—¶åªèƒ½æ·»åŠ å¤šå°ä»æœåŠ¡å™¨ï¼Œè€Œä¸èƒ½å°†æ·»åŠ çš„èŠ‚ç‚¹é…ç½®ä¸ºä¸»æœåŠ¡å™¨</p>
<h1 id="å‡†å¤‡">å‡†å¤‡</h1>
<table>
<thead>
<tr>
<th>ç”¨é€”</th>
<th>IP</th>
<th>å¤‡æ³¨</th>
</tr>
</thead>
<tbody>
<tr>
<td>provider1</td>
<td>192.168.33.10</td>
<td></td>
</tr>
<tr>
<td>provider2</td>
<td>192.168.33.11</td>
<td></td>
</tr>
</tbody>
</table>
<p>ä¸¤å°æœåŠ¡å™¨äº’ä¸ºä¸»å¤‡ï¼Œä½†æ˜¯åªèƒ½åœ¨ä¸€ä¸ªproviderä¸Šå†™ã€‚</p>
<h1 id="å®‰è£…ldap">å®‰è£…ldap</h1>
<pre><code>apt install slapd ldap-utils

#é‡æ–°é…ç½®
dpkg-reconfigure slapd
</code></pre>
<p>dn: dc=ping,dc=cn<br>
ç®¡ç†å‘˜å¯†ç ï¼šadmin</p>
<p>ä¸¤å°æœåŠ¡å™¨çš„DITè¦ä¿æŒä¸€è‡´</p>
<h1 id="å¼€å¯æ—¥å¿—å¦‚æœå·²å¼€å¯å¯å¿½ç•¥">å¼€å¯æ—¥å¿—(å¦‚æœå·²å¼€å¯å¯å¿½ç•¥)</h1>
<p>log.ldifæ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</p>
<pre><code>dn: cn=config
changetype: modify
replace: olcLogLevel
olcLogLevel: stats sync
</code></pre>
<p>åº”ç”¨é…ç½®ï¼š</p>
<pre><code>ldapmodify -Y EXTERNAL -H ldapi:/// -f log.ldif
</code></pre>
<h1 id="åŠ è½½syncprovæ¨¡å—">åŠ è½½syncprovæ¨¡å—</h1>
<p>sync.ldifæ–‡ä»¶å¦‚ä¸‹ï¼š</p>
<pre><code>dn: cn=module{0},cn=config
changetype: modify
add: olcModuleLoad
olcModuleLoad: syncprov.la

dn: olcOverlay=syncprov,olcDatabase={1}hdb,cn=config
changetype: add
objectClass: olcOverlayConfig
objectClass: olcSyncProvConfig
olcOverlay: syncprov
olcSpCheckpoint: 100 10
olcSpSessionLog: 100
</code></pre>
<p>æ³¨æ„ï¼š</p>
<ul>
<li>æŒ‡å®šçš„dnå­˜åœ¨</li>
<li>æŒ‡å®šçš„Databaseè¦å­˜åœ¨</li>
<li>æ¨¡å—æ–‡ä»¶å­˜åœ¨ï¼Œubuntu çš„æ¨¡å—ç›®å½•ä¸€èˆ¬åœ¨<code>/usr/lib/ldap</code>ç›®å½•ä¸‹,å¦‚æœåœ¨å…¶ä»–ç›®å½•ä¸‹ï¼Œå¯é€šè¿‡<code>olcModulePath</code>æŒ‡å®šç›®å½•ï¼Œä¹Ÿå¯æŸ¥çœ‹<code>cn=module{0}.ldif</code>æ–‡ä»¶<code>olcModulePath</code>æ˜¯å¦è¢«æŒ‡å®š</li>
</ul>
<p>åº”ç”¨é…ç½®ï¼š</p>
<pre><code>ldapmodify -Y EXTERNAL -H ldapi:/// -f sync.ldif
</code></pre>
<h1 id="é…ç½®mirroræ¨¡å¼">é…ç½®mirroræ¨¡å¼</h1>
<p>master01.ldifæ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š<br>
master01çš„ipåœ°å€ä¸º: <code>192.168.33.10</code></p>
<pre><code>dn: cn=config
changetype: modify
replace: olcServerID
olcServerID: 1

dn: olcDatabase={1}hdb,cn=config
changetype: modify
replace: olcSyncRepl
olcSyncRepl: rid=001
             provider=ldap://192.168.33.11:389
             bindmethod=simple
             binddn=&quot;cn=admin,dc=ping,dc=cn&quot;
             credentials=admin
             searchbase=&quot;dc=ping,dc=cn&quot;
             filter=&quot;(objectClass=*)&quot;
             scope=sub
             schemachecking=off
             attrs=&quot;*,+&quot;
             type=refreshAndPersist
             retry=&quot;5 5 300 +&quot;
             interval=00:00:01:00
-
add: olcMirrorMode
olcMirrorMode: TRUE
-
add: olcDbIndex
olcDbIndex: entryUUID eq
-
add: olcDbIndex
olcDbIndex: entryCSN eq
</code></pre>
<p>æ³¨æ„ï¼š</p>
<ul>
<li>æ­¤å¤„çš„<code>provider</code>æŒ‡å®šçš„å¦ä¸€å°æœåŠ¡å™¨çš„ip</li>
<li><code>rid</code>è¦ä¿æŒä¸€è‡´</li>
<li><code>olcServerID</code>è¦åŒºåˆ†</li>
</ul>
<p>åº”ç”¨é…ç½®ï¼š</p>
<pre><code>ldapmodify -Y EXTERNAL -H ldapi:/// -f master01.ldif
</code></pre>
<p>master02.ldifæ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</p>
<pre><code>dn: cn=config
changetype: modify
replace: olcServerID
olcServerID: 2

dn: olcDatabase={1}hdb,cn=config
changetype: modify
replace: olcSyncRepl
olcSyncRepl: rid=001
             provider=ldap://192.168.33.10:389
             bindmethod=simple
             binddn=&quot;cn=admin,dc=ping,dc=cn&quot;
             credentials=admin
             searchbase=&quot;dc=ping,dc=cn&quot;
             filter=&quot;(objectClass=*)&quot;
             scope=sub
             schemachecking=off
             attrs=&quot;*,+&quot;
             type=refreshAndPersist
             retry=&quot;5 5 300 +&quot;
             interval=00:00:01:00
-
add: olcMirrorMode
olcMirrorMode: TRUE
-
add: olcDbIndex
olcDbIndex: entryUUID eq
-
add: olcDbIndex
olcDbIndex: entryCSN eq
</code></pre>
<p>åº”ç”¨é…ç½®:</p>
<pre><code>ldapmodify -Y EXTERNAL -H ldapi:/// -f master02.ldif
</code></pre>
<h1 id="éªŒè¯">éªŒè¯</h1>
<p>1ã€æŸ¥çœ‹æ—¥å¿—ï¼š<br>
<img src="https://mrpingan.github.io/post-images/1573189656518.png" alt=""><br>
å¹¶æœªçœ‹åˆ°ä»»ä½•é”™è¯¯</p>
<p>2ã€æ·»åŠ ç”¨æˆ·<br>
åœ¨master01ä¸Šæ·»åŠ ç”¨æˆ·ï¼Œçœ‹master02ä¸Šæ˜¯å¦è¢«åŒæ­¥</p>
<p>éªŒè¯é€šè¿‡ï¼</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[ubuntu14å®‰è£…FPM]]></title>
        <id>https://mrpingan.github.io/post/ubuntu14-an-zhuang-fpm</id>
        <link href="https://mrpingan.github.io/post/ubuntu14-an-zhuang-fpm">
        </link>
        <updated>2019-09-16T08:43:52.000Z</updated>
        <content type="html"><![CDATA[<h1 id="ä»‹ç»">ä»‹ç»</h1>
<p>ä¸åŒçš„linuxå‘è¡Œç‰ˆéƒ½æœ‰ä¸åŒçš„åŒ…ç®¡ç†å·¥å…·ã€‚ä¾‹å¦‚ï¼ŒFedoraå’ŒRedhatéƒ½ä½¿ç”¨<code>.rpm</code>æ ¼å¼çš„åŒ…ï¼ŒDebianå’ŒUbuntuä½¿ç”¨<code>.deb</code>æ ¼å¼çš„åŒ…ã€‚è¿™äº›åŒ…æ˜¯ä¸å…¼å®¹çš„ï¼Œè€Œä¸”è¦ç†Ÿæ‚‰åˆ›å»ºä¸åŒåŒ…çš„æ–¹å¼ä¹Ÿå¾ˆè´¹æ—¶é—´ã€‚<br>
ä¸ºäº†æœ€å°åŒ–åˆ›å»ºåŒ…çš„å¤æ‚åº¦ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>fpm</code>å·¥å…·ã€‚ä½¿ç”¨<code>fpm</code>,ä½ å¯ä»¥å¾ˆå®¹æ˜“çš„åŒæ—¶åˆ›å»º<code>.rpm</code>å’Œ<code>.deb</code>æ–‡ä»¶ã€‚æ˜¯ä¸æ˜¯å¾ˆé…·ï¼ä¸‹é¢åœ¨<code>ubuntu 14</code>çš„ç¯å¢ƒæ¼”ç¤ºã€‚</p>
<h1 id="å®‰è£…fpm">å®‰è£…fpm</h1>
<p>fpmæ˜¯rubyè¯­è¨€å†™çš„å·¥å…·ï¼Œæ‰€ä»¥è¦å®‰è£…rubyç¯å¢ƒ</p>
<pre><code>apt-get update
apt-get install ruby-dev build-essential
</code></pre>
<p>æŸ¥çœ‹rubyç‰ˆæœ¬ï¼Œå¦‚æœç‰ˆæœ¬ä½äº2.0ï¼Œå®‰è£…fpm1.11.0çš„è¿‡ç¨‹ä¸­å°†ä¼šæŠ¥é”™</p>
<pre><code>ruby -v
</code></pre>
<p>å®‰è£…fpm</p>
<pre><code>gem install fpm
</code></pre>
<p>å®‰è£…å®Œæˆåï¼Œæ£€éªŒfpm</p>
<pre><code>fpm -help
</code></pre>
<pre><code>Intro:

  This is fpm version 1.11.0

  If you think something is wrong, it's probably a bug! :)
  Please file these here: https://github.com/jordansissel/fpm/issues

  You can find support on irc (#fpm on freenode irc) or via email with
  fpm-users@googlegroups.com

Loaded package types:
...
</code></pre>
<h2 id="å¦‚æœrubyç‰ˆæœ¬ä½äº20">å¦‚æœrubyç‰ˆæœ¬ä½äº2.0</h2>
<p>å¦‚æœrubyç‰ˆæœ¬ä½äº2.0ï¼Œéœ€è¦å®‰è£…é«˜ç‰ˆæœ¬rubyã€‚æˆ‘ä»¬ä½¿ç”¨<code>rvm</code>å·¥å…·å»å®‰è£…rubyé«˜ç‰ˆæœ¬</p>
<h3 id="å®‰è£…rvm">å®‰è£…rvm</h3>
<p>å‚è€ƒrvmåœ°å€ï¼š<a href="http://rvm.io/">rvmå®˜ç½‘</a><br>
å®‰è£…gpg2å‘½ä»¤</p>
<pre><code>apt-get install gnupg2
</code></pre>
<p>å®‰è£…GPG 2å…¬é’¥</p>
<pre><code>gpg2 --recv-keys 409B6B1796C275462A1703113804BB82D39DC0E3 7D2BAF1CF37B13E2069D6956105BD0E739499BDB
</code></pre>
<p>å®‰è£…rvm</p>
<pre><code>\curl -sSL https://get.rvm.io | bash -s stable
</code></pre>
<p>è¾“å‡ºå¦‚ä¸‹ï¼š</p>
<pre><code>Downloading https://github.com/rvm/rvm/archive/1.29.9.tar.gz
Downloading https://github.com/rvm/rvm/releases/download/1.29.9/1.29.9.tar.gz.asc
gpg: Signature made Wed 10 Jul 2019 08:31:02 AM UTC using RSA key ID 39499BDB
gpg: Good signature from &quot;Piotr Kuczynski &lt;piotr.kuczynski@gmail.com&gt;&quot;
gpg: WARNING: This key is not certified with a trusted signature!
gpg:          There is no indication that the signature belongs to the owner.
Primary key fingerprint: 7D2B AF1C F37B 13E2 069D  6956 105B D0E7 3949 9BDB
GPG verified '/usr/local/rvm/archives/rvm-1.29.9.tgz'
Creating group 'rvm'
Installing RVM to /usr/local/rvm/
Installation of RVM in /usr/local/rvm/ is almost complete:

  * First you need to add all users that will be using rvm to 'rvm' group,
    and logout - login again, anyone using rvm will be operating with `umask u=rwx,g=rwx,o=rx`.

  * To start using RVM you need to run `source /etc/profile.d/rvm.sh`
    in all your open shell windows, in rare cases you need to reopen all shell windows.
  * Please do NOT forget to add your users to the rvm group.
     The installer no longer auto-adds root or users to the rvm group. Admins must do this.
     Also, please note that group memberships are ONLY evaluated at login time.
     This means that users must log out then back in before group membership takes effect!
Thanks for installing RVM ğŸ™
Please consider donating to our open collective to help us maintain RVM.

ğŸ‘‰  Donate: https://opencollective.com/rvm/donate
</code></pre>
<p>åŠ è½½ç¯å¢ƒå˜é‡</p>
<pre><code>source /usr/local/rvm/scripts/rvm
</code></pre>
<p>ç°åœ¨å¯ä»¥ä½¿ç”¨rvmå‘½ä»¤äº†,æŸ¥çœ‹å¯å®‰è£…çš„rubyç‰ˆæœ¬</p>
<pre><code>rvm list known
</code></pre>
<p>å®‰è£…ruby 2.3</p>
<pre><code>rvm install 2.3
</code></pre>
<p>å†é€šè¿‡<code>ruby -v</code>æŸ¥çœ‹ç‰ˆæœ¬æ˜¯å¦å˜ä¸º2.3</p>
<h1 id="ç†Ÿæ‚‰fpmåŸºæœ¬åŠŸèƒ½">ç†Ÿæ‚‰fpmåŸºæœ¬åŠŸèƒ½</h1>
<p>fpm å‘½ä»¤è¡Œçš„åŸºæœ¬æ ¼å¼</p>
<pre><code>fpm -s source_type -t target_type source_name_or_location
</code></pre>
<h2 id="æŠŠä¸€ä¸ªgemåŒ…è½¬å˜ä¸ºdebåŒ…">æŠŠä¸€ä¸ªgemåŒ…è½¬å˜ä¸ºdebåŒ…</h2>
<p>bundleræ˜¯ä¸€ä¸ªå¸¸è§çš„gemåŒ…</p>
<pre><code>fpm -s gem -t deb bundler
</code></pre>
<pre><code>Debian packaging tools generally labels all files in /etc as config files, as mandated by policy, so fpm defaults to this behavior for deb packages. You can disable this default behavior with --deb-no-default-config-files flag {:level=&gt;:warn}
Created package {:path=&gt;&quot;rubygem-bundler_2.0.2_all.deb&quot;}
</code></pre>
<p>å†å½“å‰ç›®å½•å°±å¯ä»¥çœ‹åˆ°ç”Ÿæˆäº†<code>rubygem-bundler_2.0.2_all.deb</code>å®‰è£…åŒ…<br>
çœ‹çœ‹å®‰è£…ä¼šä¸ä¼šæœ‰é—®é¢˜<br>
æŸ¥çœ‹å½“å‰çš„gemåˆ—è¡¨</p>
<pre><code>root@client:~# gem list

*** LOCAL GEMS ***

arr-pm (0.0.10)
backports (3.15.0)
bigdecimal (default: 1.2.8)
bundler (default: 1.16.2)
bundler-unload (1.0.2)
cabin (0.9.0)
childprocess (0.9.0)
clamp (1.0.1)
did_you_mean (1.0.0)
dotenv (2.7.5)
executable-hooks (1.5.0)
ffi (1.11.1)
fpm (1.11.0)
gem-wrappers (1.4.0)
insist (1.0.0)
io-console (default: 0.4.5)
io-like (0.3.0)
...
</code></pre>
<p>å¯ä»¥çœ‹åˆ°bundlerçš„ç‰ˆæœ¬æ˜¯1.16.2ï¼Œæˆ‘ä»¬æ‰“åŒ…çš„ç‰ˆæœ¬æ˜¯2.0.2<br>
å®‰è£…bundler</p>
<pre><code>dpkg -i rubygem-bundler_2.0.2_all.deb
</code></pre>
<p>å†æ¬¡æŸ¥çœ‹gemå®‰è£…åˆ—è¡¨</p>
<pre><code>root@client:~# gem list

*** LOCAL GEMS ***

arr-pm (0.0.10)
backports (3.15.0)
bigdecimal (default: 1.2.8)
bundler (2.0.2, default: 1.16.2)
bundler-unload (1.0.2)
cabin (0.9.0)
childprocess (0.9.0)
clamp (1.0.1)
did_you_mean (1.0.0)
dotenv (2.7.5)
executable-hooks (1.5.0)
ffi (1.11.1)
fpm (1.11.0)
...
</code></pre>
<p>çœ‹åˆ°bundlerçš„ç‰ˆæœ¬å˜ä¸º2.0.2äº†ã€‚<br>
è¿™æ˜¯æŠŠgemåŒ…è½¬å˜ä¸ºdebåŒ…ï¼Œå±äºåŒ…ç±»å‹ä¹‹é—´çš„è½¬æ¢</p>
<h1 id="æºæ ¼å¼å’Œç›®æ ‡æ ¼å¼">æºæ ¼å¼å’Œç›®æ ‡æ ¼å¼</h1>
<p>fpmæ”¯æŒä¸‹é¢çš„æºæ ¼å¼:<br>
dirã€tarã€gemã€pythonã€pearã€cpanã€zipã€npmã€osxpkgã€emptyã€debã€rpm</p>
<p>æ”¯æŒçš„ç›®æ ‡æ ¼å¼ï¼š<br>
debã€rpmã€zipã€tarã€dirã€shã€osxpkgã€solarisã€pkginã€puppet</p>
<p><img src="https://mrpingan.github.io/post-images/1568727162483.png" alt=""></p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[æŸ¥çœ‹å‘è¡Œç‰ˆç‰ˆæœ¬]]></title>
        <id>https://mrpingan.github.io/post/cha-kan-fa-xing-ban-ban-ben</id>
        <link href="https://mrpingan.github.io/post/cha-kan-fa-xing-ban-ban-ben">
        </link>
        <updated>2019-09-16T08:25:02.000Z</updated>
        <content type="html"><![CDATA[<p>åœ¨centoså’Œubuntuä¸Šéƒ½å¯ä»¥é€šè¿‡è¿™æ¡å‘½ä»¤æŸ¥çœ‹ç‰ˆæœ¬</p>
<pre><code>cat /etc/*-release
</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[jumpserver è¿æ¥ldap]]></title>
        <id>https://mrpingan.github.io/post/jumpserver-lian-jie-ldap</id>
        <link href="https://mrpingan.github.io/post/jumpserver-lian-jie-ldap">
        </link>
        <updated>2019-09-15T12:57:20.000Z</updated>
        <content type="html"><![CDATA[<p><img src="https://mrpingan.github.io/post-images/1568552305999.png" alt=""></p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[confluenceç”¨æˆ·æ•°æ®è¿ç§»]]></title>
        <id>https://mrpingan.github.io/post/confluence-yong-hu-shu-ju-qian-yi</id>
        <link href="https://mrpingan.github.io/post/confluence-yong-hu-shu-ju-qian-yi">
        </link>
        <updated>2019-09-10T09:45:52.000Z</updated>
        <content type="html"><![CDATA[<h1 id="ç¯å¢ƒ">ç¯å¢ƒ</h1>
<p>1ã€confluenceç‰ˆæœ¬ï¼š6.15.8<br>
2ã€è€è´¦å·ï¼špingqiangqiangï¼Œç»„ï¼šopsï¼Œpostï¼šThis My first Post<br>
3ã€æ–°è´¦å·ï¼špingï¼Œç»„ï¼šnoneï¼Œpostï¼Œæ— <br>
4ã€è¾¾åˆ°ç›®æ ‡ï¼šæ–°è´¦å·ï¼špingï¼Œç»„ï¼šopsï¼Œpostï¼šThis My first Post</p>
<h1 id="æ–¹æ¡ˆä¸€">æ–¹æ¡ˆä¸€</h1>
<ul>
<li>è°ƒæ•´ç”¨æˆ·ç›®å½•é¡ºåº,å¹¶ç¦ç”¨LDAPç”¨æˆ·ç›®å½•</li>
</ul>
<p><img src="https://mrpingan.github.io/post-images/1568116514235.png" alt=""><br>
æ­¤æ—¶ï¼Œconfluenceè¯»å–çš„ç”¨æˆ·æ•°æ®éƒ½æ˜¯æœ¬åœ°ç›®å½•æ•°æ®ï¼ŒæŸ¥çœ‹æ–‡æ¡£<br>
<img src="https://mrpingan.github.io/post-images/1568116630879.png" alt=""><br>
postçš„å‘å¸ƒè€…è¿˜æ˜¯è€è´¦å·</p>
<ul>
<li>ä¿®æ”¹è€è´¦å·çš„ç”¨æˆ·åä¸ºpingï¼Œå¹¶å¯åŠ¨LDAPç”¨æˆ·ç›®å½•ï¼Œè°ƒæ•´ç”¨æˆ·ç›®å½•é¡ºåº</li>
</ul>
<p><img src="https://mrpingan.github.io/post-images/1568116799748.png" alt=""><br>
æ­¤æ—¶ï¼ŒæŸ¥çœ‹æ–‡æ¡£<br>
<img src="https://mrpingan.github.io/post-images/1568116820884.png" alt=""><br>
postçš„å‘å¸ƒè€…å˜æˆäº†æ–°è´¦å·ä¸­çš„å¯è§å<br>
æŸ¥çœ‹ç”¨æˆ·åˆ—è¡¨<br>
<img src="https://mrpingan.github.io/post-images/1568116892133.png" alt=""><br>
åªæœ‰ä¸¤ä¸ªè´¦å·ï¼Œè€è´¦å·æ”¹äº†åå­—åï¼Œç”±äºç™»å½•çš„æ—¶å€™ï¼ŒLDAPç›®å½•æ’åœ¨ç¬¬ä¸€ä¸ªï¼Œwikiå…ˆåœ¨LDAPä¸­æ‰¾åˆ°<code>ping</code>è¿™ä¸ªç”¨æˆ·ï¼Œäºæ˜¯è®¤è¯æˆåŠŸå¯ä»¥ç™»å½•ã€‚<br>
æŸ¥çœ‹æ‰€å±ç»„<br>
<img src="https://mrpingan.github.io/post-images/1568117006765.png" alt=""><br>
å‘ç°ç›´æ¥ç»§æ‰¿äº†è€è´¦å·<code>ping</code>çš„æ‰€å±ç»„ã€‚è¿™æ˜¯å› ä¸ºï¼Œåœ¨LDAPé…ç½®ä¸­ï¼Œæˆ‘ä»¬æ²¡æœ‰ä½¿ç”¨LDAPé‡Œé¢çš„ç›®å½•ç»“æ„ã€‚ç»„éƒ½åœ¨wikiä¸­æˆæƒï¼Œè€Œä¸”ï¼ŒwikiæŠŠç”¨æˆ·åå½“å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œæ‰€ä»¥ä»»åŠ¡ä¸¤ä¸ªè´¦å·æ˜¯åŒä¸€ä¸ªè´¦å·ã€‚<br>
ç›®å‰æµ‹è¯•ï¼Œè¿™ç§æ–¹æ¡ˆå¯è¡Œã€‚</p>
<h1 id="æ–¹æ¡ˆäºŒ">æ–¹æ¡ˆäºŒ</h1>
<p>å¯å‚è€ƒè¿æ¥ï¼šhttps://confluence.atlassian.com/confkb/how-to-merge-two-users-content-ownership-and-permissions-in-confluence-957149073.html</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[confluenceè¿æ¥ldaps]]></title>
        <id>https://mrpingan.github.io/post/confluence-lian-jie-ldaps</id>
        <link href="https://mrpingan.github.io/post/confluence-lian-jie-ldaps">
        </link>
        <updated>2019-09-10T04:22:51.000Z</updated>
        <content type="html"><![CDATA[<p><img src="https://mrpingan.github.io/post-images/1568089430883.png" alt=""></p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[LDAP ubuntu phpldapadmin]]></title>
        <id>https://mrpingan.github.io/post/ldap-ubuntu-phpldapadmin</id>
        <link href="https://mrpingan.github.io/post/ldap-ubuntu-phpldapadmin">
        </link>
        <updated>2019-09-08T05:54:11.000Z</updated>
        <content type="html"><![CDATA[<p>https://www.digitalocean.com/community/tutorials/how-to-install-and-configure-openldap-and-phpldapadmin-on-an-ubuntu-14-04-server</p>
<h1 id="phpldapadminè¿æ¥ldaps">phpldapadminè¿æ¥ldaps</h1>
<p>è¿™å„¿çš„sslè¯ä¹¦æ˜¯ç¬¬ä¸‰æ–¹æˆæƒçš„è¯ä¹¦ï¼Œphpldapadminçš„é…ç½®æ–‡ä»¶å¦‚ä¸‹</p>
<pre><code class="language-php">$servers-&gt;setValue('server','name','My LDAP Server');
$servers-&gt;setValue('server','host','ldaps://test-ldap.ping.net/');
$servers-&gt;setValue('server','port',636);
$servers-&gt;setValue('server','base',array('dc=ping,dc=net'));
$servers-&gt;setValue('login','auth_type','session');
$servers-&gt;setValue('login','bind_id','cn=admin,dc=ping,dc=net');
</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Jxplorerè¿æ¥LDAP]]></title>
        <id>https://mrpingan.github.io/post/jxplorer-lian-jie-ldap</id>
        <link href="https://mrpingan.github.io/post/jxplorer-lian-jie-ldap">
        </link>
        <updated>2019-09-08T05:20:46.000Z</updated>
        <content type="html"><![CDATA[<p><code>Jxplorer</code>æ˜¯JAVAè¿æ¥LDAPçš„å®¢æˆ·ç«¯ï¼Œæ”¯æŒå¤šç§è¿æ¥SSLã€SASLï¼ŒåŒæ—¶ä¹Ÿæ”¯æŒå¾ˆå¤šå¹³å°ã€‚å®˜ç½‘ä¸‹è½½åœ°å€ï¼šhttp://jxplorer.org/downloads/users.htmlã€‚</p>
<h1 id="éå®‰å…¨è¿æ¥">éå®‰å…¨è¿æ¥</h1>
<p>å¦‚æœLDAPæœåŠ¡ç«¯æœªå¼€å¯TLSï¼Œæ­¤æ—¶å»ºç«‹çš„è¿æ¥æ˜¯éå®‰å…¨è¿æ¥ï¼Œä½¿ç”¨çš„ç«¯å£æ˜¯389.<br>
<img src="https://mrpingan.github.io/post-images/1567920506007.png" alt=""><br>
å¡«å†™å¯¹åº”çš„ä¿¡æ¯ï¼Œå°±å¯ä»¥è¿æ¥ä¸Šäº†</p>
<h1 id="å®‰å…¨è¿æ¥">å®‰å…¨è¿æ¥</h1>
<p>LDAPä½¿ç”¨çš„æ˜¯SSLï¼Œå³é‡æ–°å¼€å¯ä¸€ä¸ªSSLç«¯å£æ¥å»ºç«‹å®‰å…¨é€šé“ï¼Œä¸è¿‡è¿™ç§æ–¹å¼å·²ç»è¢«æ·˜æ±°ã€‚å–è€Œä»£ä¹‹çš„æ˜¯STARTTLSï¼Œè¿™ç§æ–¹å¼å’Œ389å¤ç”¨åŒä¸€ä¸ªé€šé“ï¼Œä¸è¿‡ä¼ è¾“çš„æ•°æ®éƒ½æ˜¯åŠ å¯†çš„ã€‚<br>
æˆ‘è¿™å„¿ä½¿ç”¨çš„æ˜¯SSLï¼Œè€Œä¸”ä½¿ç”¨çš„è‡ªç­¾åCAè¯ä¹¦ã€‚å¹¶æœªä½¿ç”¨STARTTLSã€‚</p>
<h2 id="å¯¼å…¥caè¯ä¹¦">å¯¼å…¥CAè¯ä¹¦</h2>
<p>é€‰æ‹©&quot;å®‰å…¨&quot; â€”â€” &quot;ä¿¡ä»»çš„æœåŠ¡å™¨åŠCA&quot;<br>
<img src="https://mrpingan.github.io/post-images/1567920720636.png" alt=""><br>
é€‰æ‹©&quot;æ–°å¢å‡­è¯&quot;<br>
<img src="https://mrpingan.github.io/post-images/1567920784200.png" alt=""><br>
é€‰æ‹©æŒ‡å®šçš„CAè¯ä¹¦ï¼Œå¹¶ä¸ºCAè¯ä¹¦æŒ‡å®šä¸€ä¸ªåç§°<br>
<img src="https://mrpingan.github.io/post-images/1567920819137.png" alt=""><br>
è¿˜éœ€è¦è¾“å…¥ä¸€ä¸ªå¯†ç ï¼Œé»˜è®¤çš„å¯†ç æ˜¯&quot;changeit&quot;<br>
<img src="https://mrpingan.github.io/post-images/1567920864163.png" alt=""><br>
ç‚¹å‡»&quot;ç¡®è®¤&quot;ä¹‹åå°±å¯ä»¥æ­£å¸¸å¯¼å…¥äº†</p>
<p>æ–°å»ºä¸€ä¸ªè¿æ¥<br>
<img src="https://mrpingan.github.io/post-images/1567920948221.png" alt=""><br>
å¡«å†™å¯¹åº”çš„ä¿¡æ¯ï¼Œsslçš„æ–¹å¼éœ€è¦ä¿®æ”¹ç«¯å£ä¸º636ã€‚å¦‚æœLDAPä½¿ç”¨çš„æ˜¯STARTTLSçš„æ–¹å¼ï¼Œåˆ™ç«¯å£ä¾ç„¶æ˜¯389ã€‚</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Centos 7/RHEL 7é…ç½®OpenLDAP SSL]]></title>
        <id>https://mrpingan.github.io/post/centos-7rhel-7-pei-zhi-openldap-ssl</id>
        <link href="https://mrpingan.github.io/post/centos-7rhel-7-pei-zhi-openldap-ssl">
        </link>
        <updated>2019-09-07T09:01:46.000Z</updated>
        <content type="html"><![CDATA[<h1 id="é¢„å…ˆå‡†å¤‡">é¢„å…ˆå‡†å¤‡</h1>
<p>åœ¨<code>/etc/hosts</code>ä¸­æ·»åŠ ä¸€æ¡LDAPæœåŠ¡ç«¯ä¸»æœºåŸŸåæ˜ å°„è®°å½•</p>
<pre><code>192.168.33.11 server.itzgeek.local server
</code></pre>
<h1 id="åˆ›å»º-ldap-è¯ä¹¦">åˆ›å»º LDAP è¯ä¹¦</h1>
<h2 id="è‡ªç­¾åè¯ä¹¦">è‡ªç­¾åè¯ä¹¦</h2>
<p>ä¸ºLDAPæœåŠ¡ç«¯åˆ›å»ºä¸€ä¸ªè‡ªç­¾åè¯ä¹¦,ä¸‹é¢çš„å‘½ä»¤å°†ä¼šåœ¨<code>/etc/openldap/certs/</code>ç”Ÿæˆè¯ä¹¦å’Œç§é’¥</p>
<pre><code>openssl req -new -x509 -nodes -out /etc/openldap/certs/itzgeekldap.crt -keyout /etc/openldap/certs/itzgeekldap.key -days 1460
</code></pre>
<p>è¾“å‡ºå†…å®¹ï¼š</p>
<pre><code>Generating a 2048 bit RSA private key
.................................................................................+++
...................................+++
writing new private key to '/etc/openldap/certs/itzgeekldap.key'
-----
You are about to be asked to enter information that will be incorporated
into your certificate request.
What you are about to enter is what is called a Distinguished Name or a DN.
There are quite a few fields but you can leave some blank
For some fields there will be a default value,
If you enter '.', the field will be left blank.
-----
Country Name (2 letter code) [XX]:CN
State or Province Name (full name) []:shenzhen
Locality Name (eg, city) [Default City]:shenzhen
Organization Name (eg, company) [Default Company Ltd]:ITzGeek
Organizational Unit Name (eg, section) []:IT Infra
Common Name (eg, your name or your server's hostname) []:server.itzgeek.local
Email Address []:admin@itzgeek.com
</code></pre>
<p>è®¾ç½®æƒé™</p>
<pre><code>chown -R ldap:ldap /etc/openldap/certs/itzgeek*
</code></pre>
<p>æŸ¥çœ‹åˆ›å»ºçš„è¯ä¹¦å’Œç§é’¥</p>
<pre><code>[root@server openldap]# ll /etc/openldap/certs/itz*
-rw-r--r--. 1 root root 1456 Sep  7 09:08 /etc/openldap/certs/itzgeekldap.crt
-rw-r--r--. 1 root root 1704 Sep  7 09:08 /etc/openldap/certs/itzgeekldap.key
</code></pre>
<p>åˆ›å»º<code>certs.ldif</code>é…ç½®LDAPä½¿ç”¨è‡ªç­¾åè¯ä¹¦</p>
<pre><code>dn: cn=config
changetype: modify
replace: olcTLSCertificateFile
olcTLSCertificateFile: /etc/openldap/certs/itzgeekldap.crt
-
replace: olcTLSCertificateKeyFile
olcTLSCertificateKeyFile: /etc/openldap/certs/itzgeekldap.key
</code></pre>
<p>åˆ·æ–°é…ç½®ï¼š</p>
<pre><code>ldapmodify -Y EXTERNAL  -H ldapi:/// -f certs.ldif
</code></pre>
<p>éªŒè¯é…ç½®ï¼š</p>
<pre><code>slaptest -u
</code></pre>
<p>é…ç½®æ­£ç¡®æ˜¾ç¤ºå¦‚ä¸‹ï¼š</p>
<pre><code>config file testing succeeded
</code></pre>
<h1 id="è‡ªå®šä¹‰caç­¾åè¯ä¹¦">è‡ªå®šä¹‰CAç­¾åè¯ä¹¦</h1>
<p>åˆ›å»ºæ ¹ç§é’¥</p>
<pre><code>cd  /etc/openldap/certs/
openssl genrsa -out itzgeekrootCA.key 2048
</code></pre>
<p>åˆ›å»ºè‡ªç­¾åæ ¹è¯ä¹¦</p>
<pre><code>openssl req -x509 -new -nodes -key itzgeekrootCA.key -sha256 -days 1024 -out itzgeekrootCA.pem
</code></pre>
<p>è¾“å…¥ä¿¡æ¯å¦‚ä¸‹ï¼š</p>
<pre><code>You are about to be asked to enter information that will be incorporated
into your certificate request.
What you are about to enter is what is called a Distinguished Name or a DN.
There are quite a few fields but you can leave some blank
For some fields there will be a default value,
If you enter '.', the field will be left blank.
-----
Country Name (2 letter code) [XX]:CN
State or Province Name (full name) []:shenzhen
Locality Name (eg, city) [Default City]:shenzhen
Organization Name (eg, company) [Default Company Ltd]:ITzGeek
Organizational Unit Name (eg, section) []:IT Infra
Common Name (eg, your name or your server's hostname) []:ITzGeek Root CA
Email Address []:admin@itzgeek.com
</code></pre>
<p>LDAPæœåŠ¡ç«¯åˆ›å»ºç§é’¥</p>
<pre><code>openssl genrsa -out itzgeekldap.key 2048
</code></pre>
<p>æœ‰äº†ç§é’¥ä¹‹åï¼Œå°±å¯ä»¥åˆ›å»ºä¸€ä¸ªcsr(certificate signing request)æ–‡ä»¶</p>
<pre><code>openssl req -new -key itzgeekldap.key -out itzgeekldap.csr
</code></pre>
<p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p>
<pre><code>You are about to be asked to enter information that will be incorporated
into your certificate request.
What you are about to enter is what is called a Distinguished Name or a DN.
There are quite a few fields but you can leave some blank
For some fields there will be a default value,
If you enter '.', the field will be left blank.
-----
Country Name (2 letter code) [XX]:CN
State or Province Name (full name) []:shenzhen
Locality Name (eg, city) [Default City]:shenzhen
Organization Name (eg, company) [Default Company Ltd]:ITzGeek
Organizational Unit Name (eg, section) []:IT Infra
Common Name (eg, your name or your server's hostname) []:server.itzgeek.local
Email Address []:admin@itzgeek.com

Please enter the following 'extra' attributes
to be sent with your certificate request
A challenge password []:
An optional company name []:
</code></pre>
<p>ä½¿ç”¨ç”¨æˆ·æ ¹CAç­¾åä¸€ä¸ªCSR</p>
<pre><code>openssl x509 -req -in itzgeekldap.csr -CA itzgeekrootCA.pem -CAkey itzgeekrootCA.key -CAcreateserial -out itzgeekldap.crt -days 1460 -sha256
</code></pre>
<p>è®¾ç½®æƒé™</p>
<pre><code>chown -R ldap:ldap /etc/openldap/certs/itzgeek*
</code></pre>
<p>æŸ¥çœ‹è¯ä¹¦æ–‡ä»¶</p>
<pre><code>-rw-r--r--. 1 ldap ldap 1334 Sep  7 11:23 /etc/openldap/certs/itzgeekldap.crt
-rw-r--r--. 1 ldap ldap 1074 Sep  7 11:22 /etc/openldap/certs/itzgeekldap.csr
-rw-r--r--. 1 ldap ldap 1675 Sep  7 11:20 /etc/openldap/certs/itzgeekldap.key
-rw-r--r--. 1 ldap ldap 1679 Sep  7 11:17 /etc/openldap/certs/itzgeekrootCA.key
-rw-r--r--. 1 ldap ldap 1444 Sep  7 11:18 /etc/openldap/certs/itzgeekrootCA.pem
-rw-r--r--. 1 ldap ldap   17 Sep  7 11:23 /etc/openldap/certs/itzgeekrootCA.srl
</code></pre>
<p>åˆ›å»ºcerts.ldifæ–‡ä»¶æ¥é…ç½®LDAP</p>
<pre><code>vi certs.ldif
</code></pre>
<p>æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</p>
<pre><code>dn: cn=config
changetype: modify
replace: olcTLSCACertificateFile
olcTLSCACertificateFile: /etc/openldap/certs/itzgeekrootCA.pem
-
replace: olcTLSCertificateFile
olcTLSCertificateFile: /etc/openldap/certs/itzgeekldap.crt
-
replace: olcTLSCertificateKeyFile
olcTLSCertificateKeyFile: /etc/openldap/certs/itzgeekldap.key
</code></pre>
<p>åº”ç”¨é…ç½®æ–‡ä»¶</p>
<pre><code>ldapmodify -Y EXTERNAL  -H ldapi:/// -f certs.ldif
</code></pre>
<p>è¾“å‡ºå¦‚ä¸‹ï¼š</p>
<pre><code>SASL/EXTERNAL authentication started
SASL username: gidNumber=0+uidNumber=0,cn=peercred,cn=external,cn=auth
SASL SSF: 0
modifying entry &quot;cn=config&quot;

</code></pre>
<h1 id="é…ç½®openldap-ssl">é…ç½®OpenLDAP SSL</h1>
<p>ç¼–è¾‘<code>/etc/sysconfig/slapd</code>,å¢åŠ <code>ldaps:///</code></p>
<pre><code>SLAPD_URLS=&quot;ldapi:/// ldap:/// ldaps:///&quot;
</code></pre>
<p>é‡å¯æœåŠ¡</p>
<pre><code>systemctl restart slapd
</code></pre>
<p>æŸ¥çœ‹å¯åŠ¨ç«¯å£</p>
<pre><code>tcp    LISTEN     0      128       *:636                   *:*                   users:((&quot;slapd&quot;,pid=28160,fd=10))
tcp    LISTEN     0      128      :::636                  :::*                   users:((&quot;slapd&quot;,pid=28160,fd=11))
</code></pre>
<p>636æ˜¯OpenLDAP sslç«¯å£ã€‚</p>
<h1 id="openldapå®¢æˆ·ç«¯é…ç½®ssl">OpenLDAPå®¢æˆ·ç«¯é…ç½®SSL</h1>
<p>å®‰è£…è½¯ä»¶åŒ…</p>
<pre><code>yum install -y openldap-clients nss-pam-ldapd
</code></pre>
<p>æ‰§è¡Œ<code>authconfig</code>å‘½ä»¤å°†å®¢æˆ·ç«¯æœºå™¨æ³¨å†Œåˆ°æœåŠ¡ç«¯</p>
<pre><code>authconfig --enableldap --enableldapauth --ldapserver=ldaps://server.itzgeek.local --ldapbasedn=&quot;dc=itzgeek,dc=local&quot; --enablemkhomedir --disableldaptls --update
</code></pre>
<h2 id="å®¢æˆ·ç«¯é…ç½®">å®¢æˆ·ç«¯é…ç½®</h2>
<p>ç¼–è¾‘<code>nslcd.conf</code>é…ç½®æ–‡ä»¶</p>
<pre><code>	vi /etc/nslcd.conf
</code></pre>
<p>å¢åŠ ä¸€è¡Œ</p>
<pre><code>tls_reqcert allow
</code></pre>
<p>æ‹·è´LDAPæœåŠ¡ç«¯çš„CAå…¬é’¥åˆ°å®¢æˆ·ç«¯çš„<code>/etc/openldap/cacerts</code>ç›®å½•ä¸­</p>
<pre><code>cd /etc/openldap/cacerts/
scp -pr 192.168.33.11:/etc/openldap/certs/itzgeekrootCA.pem /etc/openldap/cacerts
</code></pre>
<p>ä¸ºCAè¯ä¹¦åˆ›å»ºhashå€¼</p>
<pre><code>/etc/pki/tls/misc/c_hash /etc/openldap/cacerts/itzgeekrootCA.pem
</code></pre>
<p>è¾“å‡ºï¼š</p>
<pre><code>1a981562.0 =&gt; /etc/openldap/cacerts/itzgeekrootCA.pem
</code></pre>
<p>åˆ›å»ºä¸€ä¸ªè½¯è¿æ¥</p>
<pre><code>ln -s /etc/openldap/cacerts/itzgeekrootCA.pem 1a981562.0
</code></pre>
<p>é‡å¯LDAPå®¢æˆ·ç«¯æœåŠ¡</p>
<pre><code>systemctl restart nslcd
</code></pre>
<h1 id="éªŒè¯ldapç™»å½•">éªŒè¯LDAPç™»å½•</h1>
<p>ä½¿ç”¨<code>getent</code>å‘½ä»¤æ¥è·å–LDAPæœåŠ¡ç«¯çš„æ¡ç›®</p>
<pre><code>getent passwd raj
</code></pre>
<p>è¾“å‡ºï¼š</p>
<pre><code>raj:x:9999:100:Raj [Admin (at) ITzGeek]:/home/raj:/bin/bash
</code></pre>
<p>ç™»å½•ï¼š<br>
<img src="https://mrpingan.github.io/post-images/1567857602492.png" alt=""><br>
æŸ¥çœ‹æ—¥å¿—TLSå»ºç«‹æˆåŠŸ<br>
<img src="https://mrpingan.github.io/post-images/1567858011786.png" alt=""></p>
<h1 id="é”™è¯¯è®°å½•">é”™è¯¯è®°å½•</h1>
<p>1ã€åœ¨åº”ç”¨è¯ä¹¦é…ç½®çš„æ—¶å€™ï¼ŒæŠ¥é”™</p>
<pre><code>replace olcTLSCertificateFile:
    /etc/apache2/ssl/od.censored.pl.crt
modifying entry &quot;cn=config&quot;
ldap_modify: Other (e.g., implementation specific) error (80)
</code></pre>
<p>æˆ‘çš„è§£å†³æ–¹æ¡ˆï¼Œå¯èƒ½æ˜¯è¯ä¹¦ç›®å½•æƒé™é…ç½®é—®é¢˜ï¼Œå¯é€šè¿‡<code>strace</code>åˆ†æå…·ä½“æŠ¥é”™</p>
<pre><code>strace ldapmodify -Y EXTERNAL -H ldapi:/// -vvv -f certs.ldif
</code></pre>
<p>ubuntuä¸­é…ç½®æƒé™</p>
<pre><code>chgrp openldap /etc/ssl/private/ldap01_slapd_key.pem
chmod 0640 /etc/ssl/private/ldap01_slapd_key.pem
gpasswd -a openldap ssl-cert
</code></pre>
<p>é‡å¯ldap</p>
<pre><code>systemctl restart slapd
</code></pre>
<p>ç„¶åå†æ‰§è¡Œå°±å¯ä»¥äº†ã€‚</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Centos7/RHEL 7 LDAP é…ç½®]]></title>
        <id>https://mrpingan.github.io/post/ldap-ssl-pei-zhi</id>
        <link href="https://mrpingan.github.io/post/ldap-ssl-pei-zhi">
        </link>
        <updated>2019-09-07T06:48:27.000Z</updated>
        <content type="html"><![CDATA[<h1 id="ç¯å¢ƒ">ç¯å¢ƒ</h1>
<table>
<thead>
<tr>
<th>hostname</th>
<th>ip</th>
<th>os</th>
<th>purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td>server.itzgeek.local</td>
<td>192.168.33.11</td>
<td>centos 7</td>
<td>æœåŠ¡ç«¯</td>
</tr>
<tr>
<td>client.itzgeek.local</td>
<td>192.168.33.12</td>
<td>centos 7</td>
<td>å®¢æˆ·ç«¯</td>
</tr>
</tbody>
</table>
<h1 id="è¦æ±‚">è¦æ±‚</h1>
<p>ç¡®è®¤LDAPæœåŠ¡ç«¯server.itzgeek.local(192.168.33.11)å’ŒLDAPå®¢æˆ·ç«¯client.itzgeek.local(192.168.33.12)éƒ½å¯ä»¥pingé€š<br>
ä¿è¯æ¯ä¸€å°æœåŠ¡å™¨çš„hostsæ–‡ä»¶ä¸­éƒ½åŒ…å«</p>
<pre><code>192.168.33.12   client.itzgeek.local    client
192.168.33.11   server.itzgeek.local    server
</code></pre>
<h1 id="å®‰è£…ldapåŒ…">å®‰è£…LDAPåŒ…</h1>
<p>å®‰è£…LDAPåŒ…ï¼Œopenldap-serversæ˜¯æœåŠ¡ç«¯çš„åŒ…ï¼Œopenldap-clientsæ˜¯å®¢æˆ·ç«¯<br>
<code>yum -y install openldap compat-openldap openldap-clients openldap-servers openldap-servers-sql openldap-devel</code></p>
<h2 id="å¯åŠ¨ldap-serverå¹¶åŠ å…¥è‡ªå¯åŠ¨">å¯åŠ¨LDAP serverå¹¶åŠ å…¥è‡ªå¯åŠ¨</h2>
<pre><code>systemctl start slapd
systemctl enable slapd
</code></pre>
<p>æŸ¥çœ‹LDAPæ˜¯å¦å¯åŠ¨</p>
<pre><code>ss -antup | grep -i 389
</code></pre>
<p>è¾“å‡ºå¦‚ä¸‹è¡¨ç¤ºç«¯å£å·²å¯åŠ¨</p>
<pre><code>tcp    LISTEN     0      128       *:389                   *:*                   users:((&quot;slapd&quot;,pid=5740,fd=8))
tcp    LISTEN     0      128      :::389                  :::*                   users:((&quot;slapd&quot;,pid=5740,fd=9))
</code></pre>
<h2 id="è®¾ç½®ç®¡ç†å‘˜å¯†ç ">è®¾ç½®ç®¡ç†å‘˜å¯†ç </h2>
<p>ç”ŸæˆsshaåŠ å¯†å¯†ç ,æ¯”å¦‚è¿™å„¿çš„å¯†ç ä¸ºadmin</p>
<pre><code>slappasswd -h {SSHA} -s admin
</code></pre>
<p>è¾“å‡ºï¼š</p>
<pre><code>{SSHA}nU4sM/uweUR3xhk1A521Fs5DlAO/gEbx
</code></pre>
<h2 id="é…ç½®ldapæœåŠ¡ç«¯">é…ç½®LDAPæœåŠ¡ç«¯</h2>
<p>OpenLDAPæœåŠ¡ç«¯é…ç½®æ–‡ä»¶æ”¾åœ¨<code>/etc/openldap/slapd.d/</code>ã€‚ä¿®æ”¹ä¸€ä¸‹<code>olcSuffix</code>å’Œ<code>olcRootDN</code>å˜é‡ã€‚<br>
<code>olcSuffix</code>    â€”â€”   æ•°æ®åº“åç¼€ï¼Œå®ƒæ˜¯LDAPæœåŠ¡å™¨æä¾›ä¿¡æ¯çš„åŸŸåã€‚ç®€å•æ¥è¯´ï¼Œå®ƒåº”è¯¥æ›´æ”¹ä¸ºåŸŸåã€‚<br>
<code>olcRootDN</code> â€”â€”   ä¸€èˆ¬æŒ‡çš„æ˜¯rootç”¨æˆ·ï¼Œå…·æœ‰æ‰€æœ‰è®¿é—®æƒé™çš„ç”¨æˆ·<br>
<code>olcRootPW</code> â€”â€”  RootDNçš„å¯†ç </p>
<blockquote>
<p>ä»¥ä¸Šçš„å˜é‡éœ€è¦åœ¨<code>/etc/openldap/slapd.d/cn=config/olcDatabase={2}hdb.ldif</code>ä¸­æ›´æ–°ï¼Œä¸å»ºè®®æ‰‹åŠ¨ä¿®æ”¹è¿™ä¸ªæ–‡ä»¶ï¼Œæ‰€æœ‰çš„å˜æ›´éƒ½åº”è¯¥åˆ›å»ºä¸€ä¸ª<code>.ldif</code>æ–‡ä»¶ï¼Œä½¿ç”¨ldapçš„å‘½ä»¤å»æ‰§è¡Œ</p>
</blockquote>
<pre><code>vi db.ldif
</code></pre>
<p>æ·»åŠ ä¸‹é¢çš„å†…å®¹ï¼š</p>
<pre><code>dn: olcDatabase={2}hdb,cn=config
changetype: modify
replace: olcSuffix
olcSuffix: dc=itzgeek,dc=local

dn: olcDatabase={2}hdb,cn=config
changetype: modify
replace: olcRootDN
olcRootDN: cn=admin,dc=itzgeek,dc=local

dn: olcDatabase={2}hdb,cn=config
changetype: modify
replace: olcRootPW
olcRootPW: {SSHA}nU4sM/uweUR3xhk1A521Fs5DlAO/gEbx
</code></pre>
<p>æŠŠé…ç½®å‘é€ç»™æœåŠ¡ç«¯ï¼Œä¸éœ€é‡å¯å³æ—¶ç”Ÿæ•ˆ</p>
<pre><code>ldapmodify -Y EXTERNAL  -H ldapi:/// -f db.ldif
</code></pre>
<p>è¾“å‡ºä¸‹é¢å†…å®¹è¡¨ç¤ºæˆåŠŸï¼š</p>
<pre><code>SASL/EXTERNAL authentication started
SASL username: gidNumber=0+uidNumber=0,cn=peercred,cn=external,cn=auth
SASL SSF: 0
modifying entry &quot;olcDatabase={2}hdb,cn=config&quot;

modifying entry &quot;olcDatabase={2}hdb,cn=config&quot;

modifying entry &quot;olcDatabase={2}hdb,cn=config&quot;
</code></pre>
<p>åˆšæ‰çš„æ–‡ä»¶ä¸­æˆ‘ä»¬è®¾ç½®äº†basedn,rootdn,rootpasswordï¼Œç°åœ¨æˆ‘ä»¬è®¾ç½®ä¸€ä¸‹ACLæƒé™</p>
<pre><code>vi monitor.ldif
</code></pre>
<p>ä½¿ç”¨ä¸‹é¢çš„é…ç½®ï¼š</p>
<pre><code>dn: olcDatabase={1}monitor,cn=config
changetype: modify
replace: olcAccess
olcAccess: {0}to * by dn.base=&quot;gidNumber=0+uidNumber=0,cn=peercred,cn=external, cn=auth&quot; read by dn.base=&quot;cn=admin,dc=itzgeek,dc=local&quot; read by * none
</code></pre>
<p>åŒæ ·çš„ï¼Œä¹Ÿè¦å‘é€é…ç½®ç»™æœåŠ¡ç«¯</p>
<pre><code>ldapmodify -Y EXTERNAL  -H ldapi:/// -f monitor.ldif
</code></pre>
<p>è¾“å‡ºå¦‚ä¸‹ï¼Œè¡¨ç¤ºæˆåŠŸï¼š</p>
<pre><code>SASL/EXTERNAL authentication started
SASL username: gidNumber=0+uidNumber=0,cn=peercred,cn=external,cn=auth
SASL SSF: 0
modifying entry &quot;olcDatabase={1}monitor,cn=config&quot;
</code></pre>
<h1 id="è®¾ç½®ldapæ•°æ®åº“">è®¾ç½®LDAPæ•°æ®åº“</h1>
<p>æ‹·è´æ•°æ®åº“æ ·æœ¬é…ç½®æ–‡ä»¶åˆ°<code>/var/lib/ldap</code>,æ›´æ–°æ–‡ä»¶æƒé™</p>
<pre><code>cp /usr/share/openldap-servers/DB_CONFIG.example /var/lib/ldap/DB_CONFIG
chown ldap:ldap /var/lib/ldap/*
</code></pre>
<p>å¢åŠ inetorgperson LDAP schemasï¼Œä½†æ˜¯inetorgpersonä¾èµ–cosineå’Œnis LDAP schemasï¼Œæ‰€ä»¥è¦å…ˆå®‰è£…cosineå’Œnis LDAP schemas</p>
<pre><code>ldapadd -Y EXTERNAL -H ldapi:/// -f /etc/openldap/schema/cosine.ldif
ldapadd -Y EXTERNAL -H ldapi:/// -f /etc/openldap/schema/nis.ldif 
ldapadd -Y EXTERNAL -H ldapi:/// -f /etc/openldap/schema/inetorgperson.ldif
</code></pre>
<p>é…ç½®åŸºæœ¬ç»“æ„é…ç½®æ–‡ä»¶base.ldif</p>
<pre><code>dn: dc=itzgeek,dc=local
dc: itzgeek
objectClass: top
objectClass: domain

dn: cn=admin ,dc=itzgeek,dc=local
objectClass: organizationalRole
cn: admin
description: LDAP Manager

dn: ou=People,dc=itzgeek,dc=local
objectClass: organizationalUnit
ou: People

dn: ou=Group,dc=itzgeek,dc=local
objectClass: organizationalUnit
ou: Group
</code></pre>
<p>ç”Ÿæˆç›®å½•ç»“æ„ï¼š</p>
<pre><code>ldapadd -x -W -D &quot;cn=admin,dc=itzgeek,dc=local&quot; -f base.ldif
</code></pre>
<p>è¦è¾“å…¥<code>cn=admin,dc=itzgeek,dc=local</code>çš„å¯†ç æ‰å¯ä»¥</p>
<p>è¾“å‡ºå†…å®¹ï¼š</p>
<pre><code>Enter LDAP Password:
adding new entry &quot;dc=itzgeek,dc=local&quot;

adding new entry &quot;cn=admin ,dc=itzgeek,dc=local&quot;

adding new entry &quot;ou=People,dc=itzgeek,dc=local&quot;

adding new entry &quot;ou=Group,dc=itzgeek,dc=local&quot;
</code></pre>
<p>ä½¿ç”¨<code>JXplorer</code>æŸ¥çœ‹ç›®å½•æ ‘<br>
<img src="https://mrpingan.github.io/post-images/1567842998859.png" alt=""></p>
<h1 id="åˆ›å»ºldapç”¨æˆ·">åˆ›å»ºLDAPç”¨æˆ·</h1>
<pre><code>vi raj.ldif
</code></pre>
<p>å†™å…¥ä»¥ä¸‹å†…å®¹ï¼š</p>
<pre><code>dn: uid=raj,ou=People,dc=itzgeek,dc=local
objectClass: top
objectClass: account
objectClass: posixAccount
objectClass: shadowAccount
cn: raj
uid: raj
uidNumber: 9999
gidNumber: 100
homeDirectory: /home/raj
loginShell: /bin/bash
gecos: Raj [Admin (at) ITzGeek]
userPassword: {crypt}x
shadowLastChange: 17058
shadowMin: 0
shadowMax: 99999
shadowWarning: 7
</code></pre>
<p>æŠŠé…ç½®å†™å…¥LDAPæœåŠ¡ç«¯</p>
<pre><code>ldapadd -x -W -D &quot;cn=admin,dc=itzgeek,dc=local&quot; -f raj.ldif
</code></pre>
<p>è¾“å‡ºå¦‚ä¸‹ï¼š</p>
<pre><code>Enter LDAP Password:
adding new entry &quot;uid=raj,ou=People,dc=itzgeek,dc=local&quot;
</code></pre>
<p>ç»™<code>raj</code>ç”¨æˆ·è®¾ç½®ä¸€ä¸ªå¯†ç </p>
<pre><code>ldappasswd -s password123 -W -D &quot;cn=admin,dc=itzgeek,dc=local&quot; -x &quot;uid=raj,ou=People,dc=itzgeek,dc=local&quot;
</code></pre>
<p>-s ç»™æŒ‡å®šç”¨æˆ·æŒ‡å®šå¯†ç <br>
-x æŒ‡å®šé…ç½®å¯†ç ç”¨æˆ·<br>
-D æŒ‡å®šå¯ä»¥ä¿®æ”¹å¯†ç çš„dn<br>
éªŒè¯<code>raj</code>ç”¨æˆ·ï¼š</p>
<pre><code>ldapsearch -x cn=raj -b dc=itzgeek,dc=local
</code></pre>
<p>è¾“å‡ºå¦‚ä¸‹ï¼š</p>
<pre><code># extended LDIF
#
# LDAPv3
# base &lt;dc=itzgeek,dc=local&gt; with scope subtree
# filter: cn=raj
# requesting: ALL
#

# raj, People, itzgeek.local
dn: uid=raj,ou=People,dc=itzgeek,dc=local
objectClass: top
objectClass: account
objectClass: posixAccount
objectClass: shadowAccount
cn: raj
uid: raj
uidNumber: 9999
gidNumber: 100
homeDirectory: /home/raj
loginShell: /bin/bash
gecos: Raj [Admin (at) ITzGeek]
shadowLastChange: 17058
shadowMin: 0
shadowMax: 99999
shadowWarning: 7
userPassword:: e1NTSEF9SmwvcUZRSzAzRVV0dmZ0UXNPYU9zZjdvdWdDRGR2dlA=

# search result
search: 2
result: 0 Success

# numResponses: 2
# numEntries: 1
</code></pre>
<p>åˆ é™¤ä¸€ä¸ªæ¡ç›®ï¼š</p>
<pre><code>ldapdelete -W -D &quot;cn=admin,dc=itzgeek,dc=local&quot; &quot;uid=raj,ou=People,dc=itzgeek,dc=local&quot;
</code></pre>
<h1 id="é˜²ç«å¢™">é˜²ç«å¢™</h1>
<p>å¦‚æœå¼€å¯äº†é˜²ç«å¢™ï¼Œè¦åœ¨é˜²ç«å¢™ä¸Šå¼€å¯ç«¯å£TCP(389)</p>
<pre><code>firewall-cmd --permanent --add-service=ldap
firewall-cmd --reload
</code></pre>
<h1 id="å¼€å¯ldapæ—¥å¿—">å¼€å¯LDAPæ—¥å¿—</h1>
<p>pass</p>
<h1 id="ldapå®¢æˆ·ç«¯é…ç½®">LDAPå®¢æˆ·ç«¯é…ç½®</h1>
<p>åœ¨å®¢æˆ·ç«¯æœºå™¨ä¸Šå®‰è£…å¿…è¦çš„åŒ…</p>
<pre><code>yum install -y openldap-clients nss-pam-ldapd
</code></pre>
<p>æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤å°†å®¢æˆ·ç«¯æ³¨å†Œåˆ°LDAPæœåŠ¡ç«¯ä¸Š,192.168.33.11æ˜¯LDAPæœåŠ¡ç«¯çš„IPåœ°å€</p>
<pre><code>authconfig --enableldap --enableldapauth --ldapserver=192.168.33.11 --ldapbasedn=&quot;dc=itzgeek,dc=local&quot; --enablemkhomedir --update
</code></pre>
<p>é‡å¯LDAPå®¢æˆ·ç«¯æœåŠ¡</p>
<pre><code>systemctl restart  nslcd
</code></pre>
<h1 id="éªŒè¯ldapç™»å½•">éªŒè¯LDAPç™»å½•</h1>
<p>ä½¿ç”¨<code>getent</code>å‘½ä»¤æ¥ä»LDAPæœåŠ¡ç«¯è·å–æ¡ç›®</p>
<pre><code>getent passwd raj
</code></pre>
<p>è¾“å‡ºï¼š</p>
<pre><code>raj:x:9999:100:Raj [Admin (at) ITzGeek]:/home/raj:/bin/bash
</code></pre>
<p>ä¸ºäº†éªŒè¯ï¼Œåœ¨å®¢æˆ·ç«¯æœºå™¨ä¸Šä½¿ç”¨LDAPç”¨æˆ·<code>raj</code>ç™»å½•</p>
<pre><code>ssh raj@192.168.33.12
</code></pre>
<p><img src="https://mrpingan.github.io/post-images/1567846300534.png" alt=""><br>
ç™»å½•æˆåŠŸä¹‹åï¼Œå°±ä¼šåˆ›å»ºä¸€ä¸ªå®¶ç›®å½•ï¼Œç”±äºæˆ‘æ˜¯ç¬¬äºŒæ¬¡ç™»å½•ï¼Œæ‰€ä»¥çœ‹ä¸åˆ°åˆ›å»ºå®¶ç›®å½•çš„æç¤ºä¿¡æ¯ã€‚</p>
]]></content>
    </entry>
</feed>